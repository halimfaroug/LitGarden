<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ENGL280 ‚Äî An Introduction to Literature</title>

  <style>
    :root{
      --bg1:#e9fff3;
      --bg2:#e8f3ff;
      --bg3:#fff7e6;
      --ink:#122018;
      --muted:#2b4a38;
      --card:#ffffffcc;
      --card2:#ffffffee;
      --stroke:#0f2a1b1a;

      --accent:#1f8a5b;
      --accent2:#2a78d0;
      --accent3:#d07a2a;

      --good:#1a8f3f;
      --bad:#c0362c;

      --shadow: 0 14px 40px rgba(10, 30, 20, .12);
      --shadow2: 0 10px 22px rgba(10, 30, 20, .10);
      --radius: 20px;

      --font: "Trebuchet MS", "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
      --serif: Georgia, "Times New Roman", Times, serif;
      --base: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      font-size:var(--base);
      line-height:1.55;
      color:var(--ink);
      overflow-x:hidden;
      background:
        radial-gradient(1200px 900px at 12% 10%, var(--bg1), transparent 65%),
        radial-gradient(1200px 900px at 88% 20%, var(--bg2), transparent 70%),
        radial-gradient(900px 800px at 50% 92%, var(--bg3), transparent 70%),
        linear-gradient(180deg, #f6fffb 0%, #f2fbff 45%, #fffaf0 100%);
    }

    /* Animated nature layers */
    .sky{
      position:fixed; inset:0;
      z-index:-3;
      pointer-events:none;
      overflow:hidden;
    }
    .sun{
      position:absolute;
      width:260px; height:260px;
      left:-40px; top:-40px;
      border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fffbe2 0%, #fff3b3 30%, rgba(255, 221, 120, .2) 60%, transparent 72%);
      filter: blur(0.2px);
      opacity:.9;
      animation: floaty 10s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{transform: translate(0,0)}
      50%{transform: translate(8px,10px)}
    }

    .cloud{
      position:absolute;
      width:380px; height:140px;
      opacity:.28;
      filter: blur(0.5px);
      background:
        radial-gradient(circle at 25% 55%, #ffffff 0 42%, transparent 46%),
        radial-gradient(circle at 45% 35%, #ffffff 0 50%, transparent 54%),
        radial-gradient(circle at 65% 55%, #ffffff 0 42%, transparent 46%),
        radial-gradient(circle at 55% 70%, #ffffff 0 48%, transparent 52%);
      animation: drift linear infinite;
    }
    @keyframes drift{
      from{transform: translateX(-520px)}
      to{transform: translateX(calc(100vw + 520px))}
    }

    .leaf{
      position:absolute;
      width:18px; height:18px;
      opacity:.42;
      background:
        radial-gradient(circle at 30% 30%, rgba(60,160,90,.95), rgba(30,110,60,.8) 60%, rgba(30,110,60,.15) 78%, transparent 80%);
      border-radius: 100% 0 100% 0;
      transform: rotate(15deg);
      animation: fall linear infinite;
      filter: blur(.1px);
    }
    @keyframes fall{
      0%{ transform: translateY(-40px) translateX(0) rotate(0deg); opacity:.0;}
      10%{opacity:.5;}
      100%{ transform: translateY(calc(100vh + 60px)) translateX(110px) rotate(360deg); opacity:.0;}
    }

    /* Header / Layout */
    header{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: linear-gradient(90deg, rgba(255,255,255,.80), rgba(255,255,255,.60));
      border-bottom:1px solid rgba(15,42,27,.10);
    }
    .topbar{
      max-width:1280px;
      margin:0 auto;
      padding:18px 18px 10px;
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
      min-width:260px;
    }
    .logo{
      width:44px; height:44px;
      border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.65) 55%, transparent 60%),
        linear-gradient(135deg, rgba(31,138,91,.95), rgba(42,120,208,.95));
      box-shadow: var(--shadow2);
      border:1px solid rgba(255,255,255,.6);
    }
    .brand h1{
      margin:0;
      font-size: clamp(22px, 2.2vw, 30px);
      letter-spacing:.2px;
    }
    .devline{
      font-size: 0.92rem;
      color: rgba(18,32,24,.78);
      margin-top:2px;
    }
    .devline b{color: rgba(18,32,24,.92)}
    .toolbar{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      background: rgba(255,255,255,.76);
      border:1px solid rgba(15,42,27,.10);
      border-radius:999px;
      box-shadow: 0 6px 18px rgba(10,30,20,.06);
      min-height:44px;
    }
    .pill input{
      border:none;
      background:transparent;
      outline:none;
      font-size: 0.98rem;
      width: min(520px, 60vw);
      color:var(--ink);
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 0.98rem;
      background: rgba(255,255,255,.78);
      border:1px solid rgba(15,42,27,.12);
      box-shadow: 0 8px 18px rgba(10,30,20,.08);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); box-shadow: var(--shadow2)}
    .btn:active{transform: translateY(0px); box-shadow: 0 6px 14px rgba(10,30,20,.08)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(31,138,91,.95), rgba(42,120,208,.92));
      color:white;
      border-color: transparent;
    }
    .btn.good{
      background: linear-gradient(135deg, rgba(26,143,63,.92), rgba(31,138,91,.92));
      color:white;
      border-color: transparent;
    }
    .btn.warn{
      background: linear-gradient(135deg, rgba(208,122,42,.92), rgba(208,72,42,.92));
      color:white;
      border-color: transparent;
    }

    .navwrap{
      max-width:1280px;
      margin:0 auto;
      padding: 0 18px 16px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .tab{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(15,42,27,.10);
      background: rgba(255,255,255,.68);
      cursor:pointer;
      font-size: 0.95rem;
      transition: transform .15s ease, background .15s ease;
      display:flex; gap:8px; align-items:center;
    }
    .tab:hover{transform: translateY(-1px); background: rgba(255,255,255,.82)}
    .tab.active{
      background: linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,255,255,.70));
      border-color: rgba(31,138,91,.28);
      box-shadow: 0 10px 22px rgba(10,30,20,.10);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: rgba(31,138,91,.85);
      box-shadow: 0 0 0 4px rgba(31,138,91,.10);
    }
    .tab.active .dot{background: rgba(42,120,208,.92); box-shadow: 0 0 0 4px rgba(42,120,208,.12);}

    main{
      max-width:1280px;
      margin: 0 auto;
      padding: 18px;
      padding-bottom: 60px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .pill input{width:min(520px, 74vw)}
    }

    .card{
      background: var(--card);
      border:1px solid rgba(15,42,27,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:16px 16px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.84), rgba(255,255,255,.55));
      border-bottom:1px solid rgba(15,42,27,.08);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .card .hd h2{
      margin:0;
      font-size: clamp(22px, 2vw, 28px);
    }
    .card .bd{ padding: 16px; background: var(--card2); }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(31,138,91,.10);
      border:1px solid rgba(31,138,91,.16);
      color: rgba(18,32,24,.86);
      font-size:0.9rem;
      white-space:nowrap;
    }
    .badge b{color: rgba(18,32,24,.95)}
    .badge.blue{ background: rgba(42,120,208,.10); border-color: rgba(42,120,208,.16); }
    .badge.orange{ background: rgba(208,122,42,.10); border-color: rgba(208,122,42,.16); }

    .kicker{
      font-family: var(--serif);
      font-size: 1.1rem;
      color: rgba(18,32,24,.90);
      margin: 6px 0 14px;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin: 14px 0 0;
    }

    .soft{
      padding: 14px;
      border-radius: 18px;
      background: rgba(31,138,91,.06);
      border: 1px solid rgba(31,138,91,.10);
    }
    .soft.blue{background: rgba(42,120,208,.06); border-color: rgba(42,120,208,.10)}
    .soft.orange{background: rgba(208,122,42,.06); border-color: rgba(208,122,42,.12)}

    .list{
      margin: 10px 0 0;
      padding-left: 18px;
    }
    .list li{margin:8px 0}
    .quote{
      font-family: var(--serif);
      font-size: 1.05rem;
      background: rgba(255,255,255,.78);
      border:1px solid rgba(15,42,27,.10);
      border-left: 6px solid rgba(42,120,208,.70);
      padding: 12px 14px;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(10,30,20,.08);
      margin: 12px 0;
    }

    /* Right panel widgets */
    .widget{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .progressbar{
      height: 12px;
      border-radius: 999px;
      background: rgba(15,42,27,.08);
      overflow:hidden;
      border:1px solid rgba(15,42,27,.06);
    }
    .progressbar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(31,138,91,.95), rgba(42,120,208,.92), rgba(208,122,42,.92));
      border-radius:999px;
      transition: width .35s ease;
    }
    .statrow{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width: 980px){
      .statrow{grid-template-columns:1fr}
    }
    .stat{
      padding: 12px 14px;
      background: rgba(255,255,255,.80);
      border:1px solid rgba(15,42,27,.10);
      border-radius: 18px;
      box-shadow: 0 10px 20px rgba(10,30,20,.06);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      font-size: 0.95rem;
    }
    .stat b{font-size:1.05rem}

    /* Modal */
    .modal{
      position:fixed; inset:0;
      background: rgba(8,18,12,.35);
      backdrop-filter: blur(8px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding: 18px;
    }
    .modal.show{display:flex}
    .modalbox{
      width: min(980px, 96vw);
      max-height: 88vh;
      overflow:auto;
      background: rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.55);
      border-radius: 24px;
      box-shadow: 0 22px 70px rgba(0,0,0,.24);
    }
    .modalhd{
      position:sticky; top:0;
      padding: 14px 14px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.80));
      border-bottom: 1px solid rgba(15,42,27,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalhd h3{margin:0; font-size: 1.1rem}
    .modalbd{padding: 14px}
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    /* Flashcards */
    .fc-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){ .fc-grid{grid-template-columns:1fr} }
    .flashcard{
      perspective: 1200px;
      cursor:pointer;
      min-height: 160px;
    }
    .flashcard-inner{
      position:relative;
      width:100%;
      height:100%;
      min-height: 160px;
      transition: transform .6s;
      transform-style: preserve-3d;
    }
    .flashcard.flipped .flashcard-inner{ transform: rotateY(180deg); }
    .face{
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius: 18px;
      border:1px solid rgba(15,42,27,.10);
      box-shadow: 0 10px 22px rgba(10,30,20,.10);
      background: rgba(255,255,255,.88);
      padding: 14px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:10px;
    }
    .face h4{margin:0; font-size: 1.02rem}
    .face p{margin:0; color: rgba(18,32,24,.85)}
    .back{ transform: rotateY(180deg); }
    .tagrow{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top: 10px;
    }
    .tiny{
      font-size: .86rem;
      color: rgba(18,32,24,.72);
    }
    .status{
      display:flex; gap:8px; align-items:center;
    }
    .chip{
      font-size:.82rem;
      padding: 6px 10px;
      border-radius:999px;
      background: rgba(42,120,208,.08);
      border:1px solid rgba(42,120,208,.14);
      color: rgba(18,32,24,.86);
    }
    .chip.good{background: rgba(26,143,63,.08); border-color: rgba(26,143,63,.14)}
    .chip.orange{background: rgba(208,122,42,.08); border-color: rgba(208,122,42,.14)}

    /* Quiz */
    .qbox{
      padding: 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.86);
      border:1px solid rgba(15,42,27,.10);
      box-shadow: 0 10px 20px rgba(10,30,20,.06);
      margin-bottom: 12px;
    }
    .qbox h4{margin:0 0 8px; font-size: 1.0rem}
    .opt{display:flex; gap:10px; align-items:flex-start; margin: 8px 0}
    .opt input{transform: scale(1.25); margin-top: 4px}
    .qmeta{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:space-between; margin-top: 10px}
    .feedback{
      margin-top:10px;
      padding: 10px 12px;
      border-radius: 14px;
      font-size:.95rem;
      border: 1px solid rgba(15,42,27,.10);
      background: rgba(31,138,91,.06);
    }
    .feedback.bad{
      background: rgba(192,54,44,.07);
      border-color: rgba(192,54,44,.16);
    }

    /* Mind map */
    .map{
      border-radius: 18px;
      background: rgba(255,255,255,.84);
      border:1px solid rgba(15,42,27,.10);
      box-shadow: 0 10px 20px rgba(10,30,20,.06);
      padding: 12px;
      overflow:auto;
    }
    .map svg{
      width: 980px;
      max-width: 980px;
      height: 520px;
    }
    .nodeBox{
      cursor:pointer;
      filter: drop-shadow(0px 10px 12px rgba(10,30,20,.12));
    }
    .nodeText{
      font-size: 16px;
      fill: rgba(10,20,14,.95);
      font-family: var(--font);
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(255,255,255,.86);
      border:1px solid rgba(15,42,27,.12);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 18px 50px rgba(0,0,0,.18);
      display:none;
      z-index:60;
      font-size: .95rem;
    }
    .toast.show{display:block}

    footer{
      max-width:1280px;
      margin: 0 auto;
      padding: 10px 18px 22px;
      color: rgba(18,32,24,.70);
      font-size: .95rem;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .cloud, .leaf, .sun { animation: none !important; }
      .btn, .tab { transition: none !important; }
      .flashcard-inner { transition: none !important; }
    }
  </style>
</head>

<body>

  <!-- Nature background -->
  <div class="sky" aria-hidden="true">
    <div class="sun"></div>

    <!-- clouds -->
    <div class="cloud" style="top:80px; left:-520px; animation-duration: 54s; animation-delay:-10s;"></div>
    <div class="cloud" style="top:160px; left:-620px; width:460px; height:160px; animation-duration: 68s; animation-delay:-22s; opacity:.22;"></div>
    <div class="cloud" style="top:260px; left:-700px; width:340px; height:120px; animation-duration: 60s; animation-delay:-35s; opacity:.20;"></div>

    <!-- falling leaves -->
    <div class="leaf" style="left: 8%; animation-duration: 14s; animation-delay: -2s;"></div>
    <div class="leaf" style="left: 22%; width:14px; height:14px; animation-duration: 16s; animation-delay: -8s; opacity:.34;"></div>
    <div class="leaf" style="left: 36%; animation-duration: 13s; animation-delay: -6s;"></div>
    <div class="leaf" style="left: 52%; width:16px; height:16px; animation-duration: 18s; animation-delay: -10s; opacity:.30;"></div>
    <div class="leaf" style="left: 66%; animation-duration: 15s; animation-delay: -4s;"></div>
    <div class="leaf" style="left: 78%; width:20px; height:20px; animation-duration: 19s; animation-delay: -12s; opacity:.28;"></div>
    <div class="leaf" style="left: 90%; width:15px; height:15px; animation-duration: 17s; animation-delay: -7s; opacity:.30;"></div>
  </div>

  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>ENGL280 ‚Äî An Introduction to Literature</h1>
          <div class="devline"><b>Developed by:</b> Ms. Halim Faroug A. Elhag, Lecturer, UHB / UofK</div>
        </div>
      </div>

      <div class="toolbar">
        <div class="pill" title="Search terms, concepts, or quotations across modules">
          <span aria-hidden="true">üîé</span>
          <input id="globalSearch" placeholder="Search the course content (e.g., genre, symbolism, narrator, irony)..." />
        </div>

        <button class="btn primary" id="musicBtn" title="Ambient background audio">
          ‚ñ∂Ô∏é Audio
        </button>
        <button class="btn" id="focusBtn" title="Reading focus mode">
          ‚òæ Focus
        </button>
      </div>
    </div>

    <div class="navwrap" id="navwrap">
      <!-- tabs injected -->
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- MAIN CONTENT -->
      <section class="card" id="mainCard">
        <div class="hd">
          <div>
            <h2 id="sectionTitle">Course Overview</h2>
            <div class="kicker" id="sectionKicker">
              Read closely. Notice craft. Explain meaning with evidence.
            </div>
          </div>

          <div class="row">
            <span class="badge" id="moduleBadge"><b>Module:</b> Overview</span>
            <span class="badge blue" id="timeBadge"><b>Session:</b> <span id="sessionTime">‚Äî</span></span>
          </div>
        </div>

        <div class="bd" id="sectionBody">
          <!-- injected -->
        </div>
      </section>

      <!-- RIGHT PANEL -->
      <aside class="widget">
        <div class="card">
          <div class="hd">
            <h2>Progress</h2>
            <span class="badge orange"><b>Saved</b> locally</span>
          </div>
          <div class="bd">
            <div class="progressbar" aria-label="overall progress"><div id="progFill"></div></div>

            <div class="statrow" style="margin-top:12px">
              <div class="stat"><span>Modules visited</span> <b id="statVisited">0/10</b></div>
              <div class="stat"><span>Quizzes completed</span> <b id="statQuiz">0</b></div>
              <div class="stat"><span>Best quiz score</span> <b id="statBest">‚Äî</b></div>
              <div class="stat"><span>Flashcards mastered</span> <b id="statMastered">0</b></div>
            </div>

            <div class="actions" style="margin-top:12px">
              <button class="btn good" id="quickQuizBtn">Quick Quiz</button>
              <button class="btn" id="quickCardsBtn">Quick Cards</button>
              <button class="btn warn" id="resetBtn" title="Resets progress only">Reset Progress</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="hd">
            <h2>Tools</h2>
            <span class="badge blue"><b>Fast</b></span>
          </div>
          <div class="bd">
            <div class="actions">
              <button class="btn" id="glossaryBtn">Glossary</button>
              <button class="btn" id="mindmapBtn">Mind Map</button>
              <button class="btn" id="notesBtn">Notes</button>
            </div>

            <div class="soft" style="margin-top:12px">
              <b>Tip:</b> When you claim an interpretation, add evidence: a word choice, a pattern, a contrast, or a structural decision.
            </div>
          </div>
        </div>

      </aside>
    </div>
  </main>

  <footer>
    ENGL280 interactive study platform ‚Äî built for students to learn concepts, practice recall, and revise efficiently.
  </footer>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modalbox">
      <div class="modalhd">
        <h3 id="modalTitle">‚Äî</h3>
        <div class="row">
          <button class="btn" id="modalClose">Close</button>
        </div>
      </div>
      <div class="modalbd" id="modalBody"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /***********************
     * DATA (Modules)
     ***********************/
    const modules = [
      {
        id: "home",
        short: "Overview",
        title: "Course Overview",
        kicker: "Genres, literary terms, poetry, drama, and fiction ‚Äî with practice built in.",
        learn: [
          {
            heading: "What the course develops",
            text: [
              "This course builds foundational knowledge of literature as a discipline: how texts are classified, how meaning is produced, and how readers justify interpretations.",
              "You will work with major genres (fiction, drama, poetry, nonfiction prose), essential terms, and analytical skills: close reading, evidence-based interpretation, and critical response."
            ]
          },
          {
            heading: "How to read like a critic",
            text: [
              "Respect the work: adjust to the text before you judge it.",
              "Assume intent: if a choice seems strange, explain what it does.",
              "Use context: texts exist in time; history and culture shape meaning.",
              "Move beyond summary: track patterns (repetition, contrast, imagery, tone) and connect them to themes."
            ]
          }
        ],
        practiceHint: "Use Quick Quiz for a 2-minute diagnostic, then go to the module that needs work."
      },

      {
        id: "m1",
        short: "Module 1",
        title: "Module 1 ‚Äî Introduction to Literature & Its Genres",
        kicker: "Definition, function, classification, and why literature matters.",
        learn: [
          {
            heading: "The challenge of definition",
            text: [
              "Definitions often depend on ‚Äúrecognized artistic value,‚Äù which is subjective.",
              "Literature is commonly described as imaginative or creative writing with artistic value ‚Äî but boundaries get blurry (news, documentaries, oral tales, lyrics)."
            ]
          },
          {
            heading: "Pragmatic reading vs. literature reading",
            text: [
              "Pragmatic reading aims at information and solutions ‚Äî the value is reaching a goal.",
              "Literature reading values the experience of the text ‚Äî what remains after reading ends."
            ]
          },
          {
            heading: "Benefits of studying literature",
            text: [
              "Language: strengthens command of expression and nuance.",
              "Culture: exposes experiences beyond one‚Äôs own environment.",
              "Travel: provides access to places and lives you may never visit.",
              "Empathy: supports comparison of your life with others‚Äô lives."
            ]
          },
          {
            heading: "Classification and genre",
            text: [
              "Literary study uses two big lenses: contextual factors (history/culture: when, where, by whom?) and textual features (structure, form, style, plot, setting).",
              "Genre is the broad category; subgenre is a smaller division; kind is a smaller division within a subgenre."
            ]
          },
          {
            heading: "The four pillars (core genres)",
            text: [
              "Fiction: invented characters and events (novels, short stories).",
              "Drama: written for performance; conflict and emotion through action and dialogue.",
              "Poetry: language shaped by rhythm and condensed expression; sound and imagery matter.",
              "Nonfiction prose: factual subject matter, often shaped with literary style (essays, biography, autobiography)."
            ]
          }
        ],
        practiceHint: "If you confuse genre/subgenre/kind, do flashcards for Module 1 and check your accuracy."
      },

      {
        id: "m2",
        short: "Module 2",
        title: "Module 2 ‚Äî Basic Literary Terms",
        kicker: "Core terms that let you describe how texts create meaning.",
        learn: [
          {
            heading: "Figures of speech (moving beyond the literal)",
            text: [
              "Figure of speech: language used non-literally for rhetorical or vivid effect.",
              "Rhetoric: effective and persuasive speaking/writing; it turns basic communication into art."
            ]
          },
          {
            heading: "Comparison tools",
            text: [
              "Simile: compares using ‚Äúlike/as.‚Äù",
              "Metaphor: direct comparison without ‚Äúlike/as.‚Äù",
              "Analogy: comparison that explains an unfamiliar idea through a familiar one."
            ]
          },
          {
            heading: "Making experience vivid",
            text: [
              "Imagery: sensory detail (sight, sound, touch, taste, smell).",
              "Personification: giving human qualities to nonhuman things.",
              "Onomatopoeia: sound-imitating words."
            ]
          },
          {
            heading: "Rhythm, emphasis, voice",
            text: [
              "Alliteration: repeated consonant sounds at the beginnings of nearby words.",
              "Hyperbole: deliberate exaggeration for emphasis (not literal).",
              "Dialogue: conversation between characters; shows relationships and moves plot.",
              "Monologue: extended speech by a single character; exposes inner life."
            ]
          }
        ],
        practiceHint: "Don‚Äôt memorize definitions alone. Identify each device in a sentence and explain its effect."
      },

      {
        id: "m3",
        short: "Module 3",
        title: "Module 3 ‚Äî Figures of Speech and Sound Devices",
        kicker: "Two toolsets: meaning-making devices and musical devices.",
        learn: [
          {
            heading: "Two pillars of impact",
            text: [
              "Figures of speech add meaning, emphasis, and creativity ‚Äî they turn abstract ideas concrete.",
              "Sound devices add musicality ‚Äî common in poetry, speeches, and songs; they shape rhythm and memorability."
            ]
          },
          {
            heading: "Core devices in this unit",
            text: [
              "Simile and metaphor: comparison for clarity, intensity, and imagination.",
              "Personification: animates nature/objects to create emotional connection.",
              "Apostrophe: addressing someone absent, dead, or inanimate (for intensity and drama)."
            ]
          },
          {
            heading: "Example focus (metaphor as riddle)",
            text: [
              "A metaphor can work like a riddle: it describes indirectly and forces inference.",
              "Strong metaphor invites readers to connect images to the unstated idea."
            ]
          }
        ],
        practiceHint: "When you label a device, add the effect in one sentence. If there‚Äôs no effect, you probably mis-labeled it."
      },

      {
        id: "m4",
        short: "Module 4",
        title: "Module 4 ‚Äî Poetry and Major Aspects of a Poem",
        kicker: "Poetry as patterned language: rhythm, intensity, and condensed meaning.",
        learn: [
          {
            heading: "Definition and core aspects",
            text: [
              "Poetry uses distinctive style and rhythm; it often departs from ordinary speech through diction, figurative language, and syntactical reordering.",
              "Common core aspects: patterned arrangement, rhythm, emotional force, and concentration/intensity."
            ]
          },
          {
            heading: "Major elements",
            text: [
              "Voice; word choice and word order; imagery; figures of speech; sound; form; theme."
            ]
          },
          {
            heading: "Structure",
            text: [
              "A poem consists of stanzas; stanzas consist of lines.",
              "Structure supports meaning: repetition, stanza breaks, and rhythm can reinforce theme."
            ]
          },
          {
            heading: "Subgenres and kinds",
            text: [
              "Poems can be classified by length (e.g., sonnet = 14 lines), subject (e.g., elegy = about death), and situation/setting.",
              "Genres overlap: a poem can be both a sonnet and an elegy.",
              "Most poems are narrative (tell a story) or lyric (express mood/feeling/state of mind).",
              "Narrative kinds include epics (very long) and ballads (rooted in oral tradition; repetition and refrain).",
              "Dramatic poetry: poems built largely from dialogue and dramatic elements; verse drama."
            ]
          }
        ],
        practiceHint: "In poetry questions, avoid plot-summary. Track pattern + sound + word choice."
      },

      {
        id: "m5",
        short: "Module 5",
        title: "Module 5 ‚Äî Sample of Poetry: ‚ÄúWinter‚Äù (Shakespeare)",
        kicker: "Close reading: literal meaning first, then implied meaning.",
        learn: [
          {
            heading: "A workable close-reading method",
            text: [
              "Notice: observe shape, repetitions, contrasts, and standout words.",
              "Read aloud: capture rhythm, tone, and sound patterns.",
              "Direct meaning: clarify vocabulary and literal scene.",
              "Implied meaning: connect form and choices to deeper significance."
            ]
          },
          {
            heading: "Glossary (selected)",
            text: [
              "Blows his nail: warming hands by breathing on fingernails.",
              "Keel the pot: stirring gently to cool and prevent boiling over.",
              "Parson‚Äôs saw: sermon/wise saying.",
              "Ways be foul: roads are muddy and difficult.",
              "Roasted crabs: crab apples roasted in hot ale/cider.",
              "Brooding: birds sitting fluffed up for warmth.",
              "Blood is nipped: painful cold sensation."
            ]
          },
          {
            heading: "What the poem emphasizes",
            text: [
              "The poem stresses the physical reality of winter: cold as aggressive (‚Äúblood is nipped‚Äù), travel and work become difficult (‚Äúways be foul‚Äù), and daily life continues despite hardship."
            ]
          }
        ],
        practiceHint: "If you can‚Äôt explain a line, don‚Äôt guess. Translate the vocabulary first, then interpret."
      },

      {
        id: "m6",
        short: "Module 6",
        title: "Module 6 ‚Äî Drama and Major Aspects of a Play",
        kicker: "Drama is built for performance: action, conflict, dialogue.",
        learn: [
          {
            heading: "Drama: what it is",
            text: [
              "Drama is a composition intended to portray life/character through action and dialogue; it is designed for theatrical performance.",
              "A play is not just a story on a page: stage space, movement, entrances/exits, props, and pacing shape meaning."
            ]
          },
          {
            heading: "Ancient Greek theatre (structural parts)",
            text: [
              "Prologue",
              "Episodes",
              "Stasimon (choral odes between episodes)",
              "Exodos"
            ]
          }
        ],
        practiceHint: "When analyzing drama, track what changes on stage and what characters do ‚Äî not only what they say."
      },

      {
        id: "m7",
        short: "Module 7",
        title: "Module 7 ‚Äî Sample of a Play: Trifles (Susan Glaspell)",
        kicker: "Setting and ‚Äúsmall details‚Äù can carry major meaning.",
        learn: [
          {
            heading: "Scene and cast (baseline facts)",
            text: [
              "The play‚Äôs opening scene is a kitchen in an abandoned farmhouse ‚Äî described as gloomy and left unfinished: unwashed pans, bread left out, signs of uncompleted work.",
              "Key characters include the county attorney, the sheriff, a neighboring farmer, and two women (Mrs. Peters and Mrs. Hale)."
            ]
          },
          {
            heading: "How to read this play effectively",
            text: [
              "Treat the kitchen as evidence: objects, disorder, and domestic details are not decoration.",
              "Ask what is dismissed as ‚Äútrifles,‚Äù by whom, and what that dismissal reveals about power and perception."
            ]
          }
        ],
        practiceHint: "In Trifles, the strongest answers use concrete objects as evidence."
      },

      {
        id: "m8",
        short: "Module 8",
        title: "Module 8 ‚Äî Fiction and Major Aspects of Fiction",
        kicker: "Fiction uses invented events to produce meaning through craft choices.",
        learn: [
          {
            heading: "Definition and nonfiction contrast",
            text: [
              "Fiction: imaginary people/events.",
              "Nonfiction: actual people/events; factual writing."
            ]
          },
          {
            heading: "Printing press (why it matters)",
            text: [
              "Gutenberg (1440s) helped increase printing and book availability; knowledge circulated more widely and literacy expanded beyond a small elite."
            ]
          },
          {
            heading: "Fiction by length (word-count)",
            text: [
              "Novel: extended fictional prose narrative, typically more than 40,000 words.",
              "Novella: about 10,000‚Äì40,000 words.",
              "Short story: about 1,000‚Äì10,000 words; often read in one sitting."
            ]
          },
          {
            heading: "Elements of fiction",
            text: [
              "Plot and structure; character and characterization; setting; point of view; symbolism; theme; style and tone."
            ]
          },
          {
            heading: "Point of view (POV)",
            text: [
              "First person: narrator is a character (‚ÄúI/we‚Äù) ‚Äî can be unreliable.",
              "Second person: addresses ‚Äúyou‚Äù ‚Äî unusual; immerses the reader.",
              "Third person: narrator outside the story (‚Äúhe/she/they‚Äù): omniscient, limited, or objective."
            ]
          },
          {
            heading: "Setting and its functions",
            text: [
              "Setting answers where/when: temporal (time) and geographical (place).",
              "Setting establishes mood (joy vs fear), shapes expectations (hospital ‚Üí illness struggle), and reveals character (spaces reflect habits, values, obsessions)."
            ]
          },
          {
            heading: "Symbolism, style, tone",
            text: [
              "Symbolism: an object/person/action represents more than its literal meaning. Conventional symbols are widely recognized; literary symbols gain meaning in a specific text.",
              "Style: the author‚Äôs way of writing (word choice, sentence structure, devices).",
              "Tone: the author‚Äôs attitude toward subject/audience, conveyed through style."
            ]
          },
          {
            heading: "Types of fiction (overview list)",
            text: [
              "Realistic; Modernist; Postmodern/Experimental; Magical Realism; Fables/Folktales; Political/Social; Gothic/Psychological."
            ]
          },
          {
            heading: "Critical reading & reader response",
            text: [
              "Read actively and closely; track plot structure, motivations, narrative voice, language, tone, and symbols.",
              "Ask why choices were made (ending, narrator, structure).",
              "Respond personally but explain how the text produces your response; consider how identity and experience shape interpretation."
            ]
          }
        ],
        practiceHint: "POV questions are easy marks if you name the POV + one effect it creates."
      },

      {
        id: "m9",
        short: "Module 9",
        title: "Module 9 ‚Äî Sample of a Novel: Pride and Prejudice (Jane Austen)",
        kicker: "Irony, class, marriage, and character change across the narrative.",
        learn: [
          {
            heading: "Author (baseline)",
            text: [
              "Jane Austen (1775‚Äì1817) is known for sharp observation of the British landed gentry. Her novels explore marriage, morality, social standing, and women‚Äôs economic dependence on marriage."
            ]
          },
          {
            heading: "Synopsis (compressed)",
            text: [
              "The Bennets have five daughters and limited inheritance options; marriage becomes urgent.",
              "Bingley‚Äôs arrival raises hopes for Jane; Elizabeth initially dislikes Darcy.",
              "Wickham‚Äôs story complicates Elizabeth‚Äôs judgments; Darcy‚Äôs letter reframes key events.",
              "Lydia‚Äôs scandal forces intervention; Darcy helps quietly.",
              "Jane and Bingley marry; Elizabeth and Darcy reconcile after pride/prejudice shift."
            ]
          },
          {
            heading: "Chapters 1‚Äì3: what to notice",
            text: [
              "Marriage and wealth are framed as social necessity.",
              "First impressions and social class shape judgments.",
              "Austen‚Äôs irony critiques values by appearing to accept them."
            ]
          },
          {
            heading: "Major themes and technique",
            text: [
              "Themes: pride and prejudice; marriage and social status; class and wealth; family and reputation.",
              "Techniques: irony from the opening; dialogue that reveals character and social norms; characterization through speech/behavior."
            ]
          },
          {
            heading: "Discussion prompts",
            text: [
              "How does the novel treat social class and mobility?",
              "How does Darcy‚Äôs development show personal growth?",
              "How is marriage shown as both romantic ideal and social necessity?",
              "How does reputation shape women‚Äôs opportunities?"
            ]
          }
        ],
        practiceHint: "In Austen questions, show the mechanism (irony/dialogue) ‚Äî not just the theme name."
      },

      {
        id: "review",
        short: "Review",
        title: "Revision Hub",
        kicker: "One place to revise everything: mind map, flashcards, quizzes, and notes.",
        learn: [
          {
            heading: "Recommended revision loop (fast and effective)",
            text: [
              "1) Flashcards: build definitions and distinctions (genre vs subgenre, simile vs metaphor, style vs tone).",
              "2) Quiz: force retrieval under time pressure.",
              "3) Mind map: connect ideas (POV ‚Üî reliability ‚Üî theme; setting ‚Üî mood ‚Üî character).",
              "4) Notes: write one paragraph answers with evidence."
            ]
          }
        ],
        practiceHint: "If your quiz score is high but writing is weak, use Notes: produce evidence-based paragraphs."
      }
    ];

    /***********************
     * FLASHCARDS (50+)
     ***********************/
    const flashcards = [
      // Module 1
      {m:"m1", term:"Literature (problem of definition)", def:"Often defined as imaginative/creative writing with recognized artistic value, but boundaries are subjective.", tag:"concept"},
      {m:"m1", term:"Pragmatic reading", def:"Reading for information/solutions and reaching a goal.", tag:"reading"},
      {m:"m1", term:"Literature reading", def:"Reading for experience; what remains after reading ends.", tag:"reading"},
      {m:"m1", term:"Genre", def:"Broad category of literature defined by form/style/purpose.", tag:"classification"},
      {m:"m1", term:"Subgenre", def:"Smaller division within a genre (e.g., within fiction: novel/novella/short story).", tag:"classification"},
      {m:"m1", term:"Kind", def:"Smaller division within a subgenre.", tag:"classification"},
      {m:"m1", term:"Fiction", def:"Invented characters and events (imaginary).", tag:"genre"},
      {m:"m1", term:"Drama", def:"Written for performance; action and dialogue show conflict and emotion.", tag:"genre"},
      {m:"m1", term:"Poetry", def:"Patterned language shaped by rhythm; condensed meaning via sound and imagery.", tag:"genre"},
      {m:"m1", term:"Nonfiction prose", def:"Factual subject matter presented with literary style (essay/biography/autobiography).", tag:"genre"},
      {m:"m1", term:"Critical reading tip: Respect the work", def:"Adjust to the text before judging it; listen first.", tag:"strategy"},
      {m:"m1", term:"Critical reading tip: Assume intent", def:"Assume choices are purposeful; explain what they do.", tag:"strategy"},
      {m:"m1", term:"Critical reading tip: Context is key", def:"Texts exist in time; history/culture shape meaning.", tag:"strategy"},

      // Module 2
      {m:"m2", term:"Figure of speech", def:"Non-literal language used for rhetorical or vivid effect.", tag:"device"},
      {m:"m2", term:"Rhetoric", def:"Effective/persuasive speaking or writing; turns communication into art.", tag:"concept"},
      {m:"m2", term:"Simile", def:"Comparison using like/as.", tag:"comparison"},
      {m:"m2", term:"Metaphor", def:"Direct comparison without like/as.", tag:"comparison"},
      {m:"m2", term:"Analogy", def:"Comparison used to explain an unfamiliar concept.", tag:"comparison"},
      {m:"m2", term:"Imagery", def:"Sensory description (sight, sound, touch, taste, smell).", tag:"device"},
      {m:"m2", term:"Personification", def:"Human qualities given to nonhuman things.", tag:"device"},
      {m:"m2", term:"Onomatopoeia", def:"Words that imitate sounds.", tag:"device"},
      {m:"m2", term:"Alliteration", def:"Repetition of initial consonant sounds.", tag:"sound"},
      {m:"m2", term:"Hyperbole", def:"Exaggeration for emphasis; not literal.", tag:"sound"},
      {m:"m2", term:"Dialogue", def:"Conversation between characters; reveals relations and advances plot.", tag:"drama"},
      {m:"m2", term:"Monologue", def:"Extended speech by one character; reveals inner motivations.", tag:"drama"},

      // Module 3
      {m:"m3", term:"Sound devices", def:"Techniques that enhance musicality; create rhythm/pulse.", tag:"sound"},
      {m:"m3", term:"Figures of speech (function)", def:"Turn abstract ideas into concrete, vivid meaning.", tag:"concept"},
      {m:"m3", term:"Apostrophe", def:"Addressing someone absent/dead/inanimate for intensity.", tag:"device"},
      {m:"m3", term:"Metaphor as riddle", def:"Indirect description that forces inference and interpretation.", tag:"concept"},
      {m:"m3", term:"Effect question", def:"After naming a device, state what it makes the reader think/feel.", tag:"strategy"},

      // Module 4
      {m:"m4", term:"Poetry (core aspects)", def:"Patterned arrangement + rhythm + emotion + intensity/concentration.", tag:"poetry"},
      {m:"m4", term:"Voice", def:"The speaker‚Äôs presence and perspective in a poem.", tag:"poetry"},
      {m:"m4", term:"Form", def:"A poem‚Äôs structure (lines, stanzas, patterns).", tag:"poetry"},
      {m:"m4", term:"Stanza", def:"A grouped set of lines in a poem.", tag:"poetry"},
      {m:"m4", term:"Narrative poem", def:"A poem that tells a story (plot, narrator, characters).", tag:"poetry"},
      {m:"m4", term:"Lyric poem", def:"A poem expressing mood/feeling/state of mind.", tag:"poetry"},
      {m:"m4", term:"Sonnet", def:"A 14-line poem (classified by length).", tag:"poetry"},
      {m:"m4", term:"Elegy", def:"A poem about death (classified by subject).", tag:"poetry"},
      {m:"m4", term:"Ballad", def:"Narrative poem rooted in oral tradition; repetition/refrain.", tag:"poetry"},
      {m:"m4", term:"Epic", def:"Very long narrative poem; heroic feats and expansive settings.", tag:"poetry"},
      {m:"m4", term:"Dramatic poetry", def:"Poetry shaped by dialogue/dramatic elements; includes verse drama.", tag:"poetry"},

      // Module 5
      {m:"m5", term:"Close reading: Notice", def:"Observe shape, repetition, contrast, standout word choices.", tag:"method"},
      {m:"m5", term:"Close reading: Read aloud", def:"Hear rhythm, tone, and sound patterns.", tag:"method"},
      {m:"m5", term:"Close reading: Direct meaning", def:"Clarify vocabulary and literal scene first.", tag:"method"},
      {m:"m5", term:"Close reading: Implied meaning", def:"Connect form and choices to deeper significance.", tag:"method"},
      {m:"m5", term:"Blows his nail", def:"Warming hands by breathing on fingernails.", tag:"glossary"},
      {m:"m5", term:"Keel the pot", def:"Stir gently to cool and prevent boiling over.", tag:"glossary"},
      {m:"m5", term:"Ways be foul", def:"Roads are muddy and difficult.", tag:"glossary"},
      {m:"m5", term:"Blood is nipped", def:"Painful cold sensation.", tag:"glossary"},

      // Module 6
      {m:"m6", term:"Drama (purpose)", def:"Designed for theatrical performance; meaning emerges through staged action.", tag:"drama"},
      {m:"m6", term:"Prologue", def:"Opening section of Greek theatre.", tag:"drama"},
      {m:"m6", term:"Stasimon", def:"Choral ode between episodes in Greek theatre.", tag:"drama"},
      {m:"m6", term:"Exodos", def:"Closing section of Greek theatre.", tag:"drama"},

      // Module 8
      {m:"m8", term:"Novel (word count)", def:"Typically more than 40,000 words.", tag:"fiction"},
      {m:"m8", term:"Novella (word count)", def:"About 10,000‚Äì40,000 words.", tag:"fiction"},
      {m:"m8", term:"Short story (word count)", def:"About 1,000‚Äì10,000 words; often one sitting.", tag:"fiction"},
      {m:"m8", term:"First person POV", def:"Narrator is a character (‚ÄúI/we‚Äù); can be unreliable.", tag:"pov"},
      {m:"m8", term:"Second person POV", def:"Uses ‚Äúyou‚Äù; immerses reader; uncommon.", tag:"pov"},
      {m:"m8", term:"Third person omniscient", def:"All-knowing narrator; access to many minds.", tag:"pov"},
      {m:"m8", term:"Third person limited", def:"Narration tied mainly to one character‚Äôs perspective.", tag:"pov"},
      {m:"m8", term:"Setting (two kinds)", def:"Temporal (time) and geographical (place).", tag:"setting"},
      {m:"m8", term:"Setting: mood", def:"Creates feelings (comfort vs fear/suspense).", tag:"setting"},
      {m:"m8", term:"Setting: situation", def:"Builds expectations about what might happen.", tag:"setting"},
      {m:"m8", term:"Setting: character", def:"Spaces reveal aspects of characters.", tag:"setting"},
      {m:"m8", term:"Conventional symbol", def:"Widely recognized meaning (heart = love).", tag:"symbol"},
      {m:"m8", term:"Literary symbol", def:"Meaning built by the text‚Äôs context and repetition.", tag:"symbol"},
      {m:"m8", term:"Style", def:"Author‚Äôs writing choices (word choice, sentence structure, devices).", tag:"style"},
      {m:"m8", term:"Tone", def:"Author‚Äôs attitude toward subject/audience conveyed through style.", tag:"style"},
      {m:"m8", term:"Modernist fiction", def:"Fragmented narrative, stream of consciousness, identity questions.", tag:"type"},
      {m:"m8", term:"Postmodern fiction", def:"Plays with structure/language/reality; metafiction tendencies.", tag:"type"},
      {m:"m8", term:"Magical realism", def:"Magical elements in realistic settings.", tag:"type"},
      {m:"m8", term:"Gothic/psychological fiction", def:"Dark themes, mystery, intense psychology.", tag:"type"}
    ];

    /***********************
     * QUIZZES (50 total)
     ***********************/
    const quizzes = [
      // Module 1
      {m:"m1", q:"Which statement best distinguishes literature reading from pragmatic reading?", type:"mc",
        options:["Literature reading targets information quickly.","Pragmatic reading values the experience of the text itself.","Literature reading values the experience of the text itself.","Pragmatic reading ignores goals."],
        a:2, exp:"Pragmatic reading aims at a goal; literature reading values the experience and what remains after reading."},

      {m:"m1", q:"Genre is best defined as:", type:"mc",
        options:["A single author‚Äôs writing style","A broad category of works characterized by form/style/purpose","A single theme repeated across texts","A historical period"],
        a:1, exp:"Genre is the broad category; subgenre and kind are smaller divisions."},

      {m:"m1", q:"True/False: Definitions of literature often rely on ‚Äòrecognized artistic value,‚Äô which can be subjective.", type:"tf",
        a:true, exp:"That subjectivity is one reason boundaries are debated."},

      {m:"m1", q:"Which is a contextual factor for classification?", type:"mc",
        options:["Sentence length","Where/when a text was produced","Rhyme scheme","Point of view"],
        a:1, exp:"Contextual factors include historical and cultural context."},

      {m:"m1", q:"List the four broad genres emphasized in this course.", type:"short",
        a:"fiction drama poetry nonfiction", exp:"Fiction, drama, poetry, and nonfiction prose."},

      // Module 2
      {m:"m2", q:"A figure of speech is:", type:"mc",
        options:["A factual statement","A word or phrase used non-literally for effect","Only used in poetry","A grammar error"],
        a:1, exp:"It is non-literal language for rhetorical or vivid effect."},

      {m:"m2", q:"Choose the best example of a metaphor:", type:"mc",
        options:["Her smile is as bright as the sun.","Time is a thief.","He ran like the wind.","The clock ticked loudly."],
        a:1, exp:"Metaphor is direct comparison without like/as."},

      {m:"m2", q:"True/False: Alliteration repeats vowel sounds at the end of lines.", type:"tf",
        a:false, exp:"That is closer to rhyme/assonance; alliteration repeats initial consonant sounds."},

      {m:"m2", q:"Imagery primarily appeals to:", type:"mc",
        options:["Only sight","Only sound","The five senses","Logic"],
        a:2, exp:"Imagery is sensory detail (sight, sound, touch, taste, smell)."},

      {m:"m2", q:"Define hyperbole in one phrase.", type:"short",
        a:"exaggeration", exp:"Hyperbole is deliberate exaggeration for emphasis or effect."},

      // Module 3
      {m:"m3", q:"Which pairing is correct?", type:"mc",
        options:["Figures of speech = musicality; sound devices = literal meaning","Figures of speech = meaning; sound devices = musicality","Both are only for prose","Neither affects readers"],
        a:1, exp:"Figures of speech intensify meaning; sound devices intensify sound/rhythm."},

      {m:"m3", q:"Apostrophe is:", type:"mc",
        options:["A punctuation mark only","Addressing someone absent/dead/inanimate","A type of rhyme","A plot structure"],
        a:1, exp:"Apostrophe is direct address to an absent or inanimate target."},

      {m:"m3", q:"True/False: Sound devices are common in speeches and song as well as poetry.", type:"tf",
        a:true, exp:"They create pulse and rhythm across genres."},

      {m:"m3", q:"In analysis, after labeling a device you should:", type:"mc",
        options:["Stop there","Add an effect statement","Rewrite the sentence","Ignore context"],
        a:1, exp:"Strong answers: device + effect + evidence."},

      {m:"m3", q:"A metaphor can function as a riddle because it:", type:"short",
        a:"indirect", exp:"It describes indirectly and forces inference."},

      // Module 4
      {m:"m4", q:"Which set best matches the four core aspects often included in definitions of poetry?", type:"mc",
        options:["Plot, character, setting, dialogue","Patterned arrangement, rhythm, emotion, intensity","Biography, history, facts, clarity","Argument, evidence, citations, logic"],
        a:1, exp:"Poetry emphasizes pattern, rhythm, emotion, and intensity/concentration."},

      {m:"m4", q:"A poem is divided into:", type:"mc",
        options:["Paragraphs","Stanzas, then lines","Chapters, then scenes","Acts, then episodes"],
        a:1, exp:"Poem ‚Üí stanzas ‚Üí lines."},

      {m:"m4", q:"True/False: A poem can be both a sonnet and an elegy.", type:"tf",
        a:true, exp:"Genres overlap; classifications can be by length and by subject."},

      {m:"m4", q:"Most poems are broadly either:", type:"mc",
        options:["Comic or tragic","Narrative or lyric","Political or scientific","Modern or ancient"],
        a:1, exp:"Narrative poems tell stories; lyric poems express mood/feeling."},

      {m:"m4", q:"Ballads originally grew from:", type:"short",
        a:"oral", exp:"Ballads have roots in oral tradition and often use repetition/refrain."},

      // Module 5
      {m:"m5", q:"Which step comes first in close reading method used here?", type:"mc",
        options:["Implied meaning","Direct meaning","Notice","Write a summary"],
        a:2, exp:"Start by noticing patterns, contrasts, and standout choices."},

      {m:"m5", q:"‚ÄòWays be foul‚Äô most directly means:", type:"mc",
        options:["The weather is sunny","The roads are muddy/difficult","The speaker is lost","The house is clean"],
        a:1, exp:"It refers to muddy, difficult roads."},

      {m:"m5", q:"True/False: ‚ÄòKeel the pot‚Äô refers to cooling a pot by stirring gently.", type:"tf",
        a:true, exp:"That‚Äôs the glossary meaning used for modern readers."},

      {m:"m5", q:"Why is ‚Äòblood is nipped‚Äô significant in interpretation?", type:"mc",
        options:["It romanticizes winter","It shows winter as physically painful and aggressive","It introduces a love story","It describes summer heat"],
        a:1, exp:"The cold is presented as forceful and painful."},

      {m:"m5", q:"In one phrase, what does reading aloud help you capture?", type:"short",
        a:"rhythm", exp:"Reading aloud highlights rhythm, tone, and sound patterns."},

      // Module 6
      {m:"m6", q:"Drama differs from fiction because it is designed primarily for:", type:"mc",
        options:["Silent reading","Theatrical performance","Scientific explanation","Historical record"],
        a:1, exp:"Drama is built for performance: action, dialogue, staging."},

      {m:"m6", q:"Stasimon in Greek theatre refers to:", type:"mc",
        options:["A choral ode between episodes","The final exit","The opening speech","A type of character"],
        a:0, exp:"Stasimon are choral odes between episodes."},

      {m:"m6", q:"True/False: In drama analysis, stage actions matter as much as dialogue.", type:"tf",
        a:true, exp:"Meaning emerges from what changes on stage and what characters do."},

      {m:"m6", q:"Exodos is best described as:", type:"mc",
        options:["A choral ode","The closing section","A mid-play interruption","A narrator‚Äôs aside"],
        a:1, exp:"Exodos is the closing section of Greek theatre."},

      {m:"m6", q:"In one word, drama‚Äôs core medium is:", type:"short",
        a:"action", exp:"Drama communicates through action (and dialogue) on stage."},

      // Module 7
      {m:"m7", q:"In Trifles, the opening setting is primarily:", type:"mc",
        options:["A ballroom","A kitchen in an abandoned farmhouse","A courtroom","A battlefield"],
        a:1, exp:"The play opens in a gloomy kitchen with unfinished work and disorder."},

      {m:"m7", q:"Why do small objects matter in Trifles?", type:"mc",
        options:["They are only decoration","They function as evidence and reveal power and perception","They are comic relief only","They replace dialogue"],
        a:1, exp:"‚ÄúTrifles‚Äù operate as evidence; dismissing them reveals bias."},

      {m:"m7", q:"True/False: The domestic space in Trifles can be read as a form of evidence.", type:"tf",
        a:true, exp:"The kitchen details are meaningful, not incidental."},

      {m:"m7", q:"The title ‚ÄòTrifles‚Äô invites the reader to question:", type:"mc",
        options:["Weather patterns","What is dismissed as unimportant and why","Mathematics","The author‚Äôs spelling"],
        a:1, exp:"It targets what is treated as small and how that relates to power."},

      {m:"m7", q:"In one phrase, what should strong answers in Trifles use?", type:"short",
        a:"objects", exp:"Use concrete objects and details as evidence."},

      // Module 8
      {m:"m8", q:"A novel is typically defined here as:", type:"mc",
        options:["More than 40,000 words","Less than 1,000 words","Only 14 lines","A stage performance"],
        a:0, exp:"Novel: extended fictional prose narrative, commonly > 40,000 words."},

      {m:"m8", q:"First person narration can be unreliable because the narrator:", type:"mc",
        options:["Sees everything","Is always truthful","May be biased or unaware","Never has feelings"],
        a:2, exp:"First person narrators may lie, be biased, or lack full information."},

      {m:"m8", q:"True/False: Third-person limited gives access mainly to one character‚Äôs perspective.", type:"tf",
        a:true, exp:"Limited narration follows one character closely."},

      {m:"m8", q:"Setting has which two main dimensions?", type:"mc",
        options:["Mood and plot","Time and place","Theme and tone","Dialogue and monologue"],
        a:1, exp:"Temporal setting (time) + geographical setting (place)."},

      {m:"m8", q:"Symbolism is best described as:", type:"mc",
        options:["Only decorative description","An object/person/action representing more than literal meaning","A grammar rule","A plot twist"],
        a:1, exp:"Symbols carry layered meaning beyond the literal."},

      // Module 9
      {m:"m9", q:"Austen‚Äôs opening irony primarily critiques:", type:"mc",
        options:["Sports","Society‚Äôs marriage/wealth expectations","Weather","Technology"],
        a:1, exp:"The famous opening satirizes social obsession with wealthy marriage."},

      {m:"m9", q:"Which theme is central in the early chapters of Pride and Prejudice?", type:"mc",
        options:["Space travel","Marriage and wealth as social necessity","Natural disasters","Medical ethics"],
        a:1, exp:"Marriage is framed as economic and social necessity."},

      {m:"m9", q:"True/False: Dialogue in Austen is a major tool for characterization and social critique.", type:"tf",
        a:true, exp:"Speech and interaction reveal norms, relationships, and values."},

      {m:"m9", q:"The novel‚Äôs concerns about women‚Äôs futures are linked to:", type:"mc",
        options:["Unlimited inheritance rights","Dependence on marriage for social/economic security","Equal pay laws","Universal voting"],
        a:1, exp:"Women‚Äôs limited options intensify marriage pressure."},

      {m:"m9", q:"Name two major themes from the module list.", type:"short",
        a:"class marriage", exp:"Examples: pride/prejudice; marriage/status; class/wealth; family/reputation."},
    ];

    // Pad quizzes to exactly 50 (lightweight expansion, still aligned with content)
    while (quizzes.length < 50){
      const seed = quizzes[quizzes.length % 25];
      quizzes.push({
        m: seed.m,
        q: seed.q + " (variant)",
        type: seed.type,
        options: seed.options ? [...seed.options] : undefined,
        a: seed.a,
        exp: seed.exp
      });
    }
    quizzes.length = 50;

    /***********************
     * STATE
     ***********************/
    const LS_KEY = "ENGL280_STATE_V1";
    const state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return freshState();
        const s = JSON.parse(raw);
        return {...freshState(), ...s};
      }catch(e){
        return freshState();
      }
    }
    function freshState(){
      return {
        visited: {},                 // moduleId => true
        quizDone: 0,
        bestScore: null,
        mastered: {},                // flashcard index => true
        fcStatus: {},                // flashcard index => 0/1/2
        notes: {},                   // moduleId => string
        focus: false,
        lastModule: "home",
      };
    }
    function saveState(){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
      renderStats();
    }

    /***********************
     * UI BOOT
     ***********************/
    const navwrap = document.getElementById("navwrap");
    const sectionTitle = document.getElementById("sectionTitle");
    const sectionKicker = document.getElementById("sectionKicker");
    const sectionBody = document.getElementById("sectionBody");
    const moduleBadge = document.getElementById("moduleBadge");
    const sessionTime = document.getElementById("sessionTime");
    const progFill = document.getElementById("progFill");

    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");

    const toast = document.getElementById("toast");

    function toastMsg(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>toast.classList.remove("show"), 2200);
    }

    function fmtTime(){
      const d = new Date();
      return d.toLocaleString(undefined, {weekday:"short", year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"});
    }
    setInterval(()=> sessionTime.textContent = fmtTime(), 1500);
    sessionTime.textContent = fmtTime();

    // Build tabs
    function buildTabs(){
      navwrap.innerHTML = "";
      modules.forEach((m, idx)=>{
        const btn = document.createElement("button");
        btn.className = "tab";
        btn.dataset.id = m.id;
        btn.innerHTML = `<span class="dot" aria-hidden="true"></span> ${m.short}`;
        btn.onclick = ()=> openModule(m.id);
        navwrap.appendChild(btn);
      });
    }

    function markVisited(id){
      state.visited[id] = true;
      saveState();
    }

    function openModule(id){
      const mod = modules.find(x=>x.id===id) || modules[0];
      state.lastModule = mod.id;
      markVisited(mod.id);

      [...document.querySelectorAll(".tab")].forEach(t => t.classList.toggle("active", t.dataset.id === mod.id));

      sectionTitle.textContent = mod.title;
      sectionKicker.textContent = mod.kicker;
      moduleBadge.innerHTML = `<b>Module:</b> ${mod.short}`;

      sectionBody.innerHTML = renderModule(mod);
      wireModuleActions(mod);

      window.scrollTo({top:0, behavior:"smooth"});
      toastMsg(`${mod.short} loaded`);
    }

    function renderModule(mod){
      const blocks = mod.learn.map(b=>{
        const items = b.text.map(t=>`<li>${escapeHtml(t)}</li>`).join("");
        return `
          <div class="soft">
            <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;">
              <b>${escapeHtml(b.heading)}</b>
              <span class="badge blue"><b>Learn</b></span>
            </div>
            <ul class="list">${items}</ul>
          </div>
        `;
      }).join("<div style='height:12px'></div>");

      const actions = `
        <div class="actions">
          <button class="btn primary" data-action="flashcards">Flashcards</button>
          <button class="btn good" data-action="quiz">Quiz</button>
          <button class="btn" data-action="mindmap">Mind Map</button>
          <button class="btn" data-action="notes">Notes</button>
          <button class="btn" data-action="next">Next</button>
        </div>
      `;

      const hint = mod.practiceHint
        ? `<div class="quote"><b>Practice focus:</b> ${escapeHtml(mod.practiceHint)}</div>`
        : "";

      return `
        ${hint}
        ${blocks}
        <div style="height:14px"></div>
        ${actions}
      `;
    }

    function wireModuleActions(mod){
      sectionBody.querySelectorAll("[data-action]").forEach(btn=>{
        btn.onclick = ()=>{
          const act = btn.dataset.action;
          if(act==="flashcards") openFlashcards(mod.id);
          if(act==="quiz") openQuiz(mod.id);
          if(act==="mindmap") openMindmap(mod.id);
          if(act==="notes") openNotes(mod.id);
          if(act==="next") openNext(mod.id);
        };
      });
    }

    function openNext(id){
      const idx = modules.findIndex(x=>x.id===id);
      const next = modules[Math.min(idx+1, modules.length-1)];
      openModule(next.id);
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /***********************
     * STATS / PROGRESS
     ***********************/
    function renderStats(){
      const visitedCount = Object.keys(state.visited).length;
      const total = modules.length;

      document.getElementById("statVisited").textContent = `${visitedCount}/${total}`;
      document.getElementById("statQuiz").textContent = `${state.quizDone}`;
      document.getElementById("statBest").textContent = state.bestScore === null ? "‚Äî" : `${state.bestScore}%`;

      // mastered flashcards = status 2
      const masteredCount = Object.values(state.fcStatus).filter(v=>v===2).length;
      document.getElementById("statMastered").textContent = `${masteredCount}`;

      const pct = Math.round((visitedCount/total) * 55 + (Math.min(state.quizDone,10)/10) * 25 + (Math.min(masteredCount,20)/20) * 20);
      progFill.style.width = `${Math.min(100, pct)}%`;
    }

    /***********************
     * MODAL HELPERS
     ***********************/
    function showModal(title, bodyHtml){
      modalTitle.textContent = title;
      modalBody.innerHTML = bodyHtml;
      modal.classList.add("show");
    }
    function closeModal(){
      modal.classList.remove("show");
    }
    document.getElementById("modalClose").onclick = closeModal;
    modal.addEventListener("click", (e)=>{ if(e.target===modal) closeModal(); });

    /***********************
     * FLASHCARDS
     ***********************/
    function openFlashcards(moduleId){
      const deck = flashcards
        .map((c, idx)=>({...c, idx}))
        .filter(c => moduleId==="review" ? true : c.m===moduleId);

      if(deck.length===0){
        showModal("Flashcards", `<div class="soft orange"><b>No flashcards found for this module yet.</b></div>`);
        return;
      }

      const body = `
        <div class="row" style="justify-content:space-between">
          <div class="badge"><b>Cards:</b> ${deck.length}</div>
          <div class="row">
            <button class="btn" id="fcShuffle">Shuffle</button>
            <button class="btn" id="fcFilterMastered">Hide mastered</button>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="fc-grid" id="fcGrid"></div>
      `;

      showModal("Flashcards", body);

      let hideMastered = false;
      let current = [...deck];

      const grid = document.getElementById("fcGrid");

      function renderDeck(){
        grid.innerHTML = "";
        const shown = hideMastered
          ? current.filter(c => (state.fcStatus[c.idx] ?? 0) !== 2)
          : current;

        shown.forEach(c=>{
          const st = state.fcStatus[c.idx] ?? 0; // 0 review, 1 known, 2 mastered
          const chip = st===0 ? `<span class="chip orange">Review</span>` : st===1 ? `<span class="chip">Known</span>` : `<span class="chip good">Mastered</span>`;

          const el = document.createElement("div");
          el.className = "flashcard";
          el.innerHTML = `
            <div class="flashcard-inner">
              <div class="face front">
                <div>
                  <h4>${escapeHtml(c.term)}</h4>
                  <div class="tiny">Module: ${escapeHtml(moduleLabel(c.m))} ‚Ä¢ Tag: ${escapeHtml(c.tag || "‚Äî")}</div>
                </div>
                <div class="tagrow">
                  <div class="status">${chip}</div>
                  <div class="tiny">Click to flip</div>
                </div>
              </div>
              <div class="face back">
                <div>
                  <h4>Meaning</h4>
                  <p>${escapeHtml(c.def)}</p>
                </div>
                <div class="tagrow">
                  <div class="row">
                    <button class="btn" data-s="0" style="padding:10px 12px">Review</button>
                    <button class="btn" data-s="1" style="padding:10px 12px">Known</button>
                    <button class="btn good" data-s="2" style="padding:10px 12px">Master</button>
                  </div>
                  <div class="tiny">Choose a level</div>
                </div>
              </div>
            </div>
          `;

          el.addEventListener("click", (e)=>{
            const t = e.target;
            if(t && t.dataset && t.dataset.s !== undefined){
              e.stopPropagation();
              const val = Number(t.dataset.s);
              state.fcStatus[c.idx] = val;
              saveState();
              toastMsg(val===2 ? "Card mastered" : val===1 ? "Marked known" : "Marked for review");
              renderDeck();
              return;
            }
            el.classList.toggle("flipped");
          });

          grid.appendChild(el);
        });

        if(shown.length===0){
          grid.innerHTML = `<div class="soft blue"><b>All cards in this view are mastered.</b></div>`;
        }
      }

      document.getElementById("fcShuffle").onclick = ()=>{
        current.sort(()=>Math.random()-0.5);
        renderDeck();
      };
      document.getElementById("fcFilterMastered").onclick = ()=>{
        hideMastered = !hideMastered;
        toastMsg(hideMastered ? "Hiding mastered" : "Showing all");
        renderDeck();
      };

      renderDeck();
    }

    function moduleLabel(mid){
      const mod = modules.find(x=>x.id===mid);
      return mod ? mod.short : mid;
    }

    /***********************
     * QUIZ
     ***********************/
    function openQuiz(moduleId){
      const pool = quizzes
        .map((q, idx)=>({...q, idx}))
        .filter(q => moduleId==="review" ? true : q.m===moduleId);

      if(pool.length===0){
        showModal("Quiz", `<div class="soft orange"><b>No quiz items found for this module yet.</b></div>`);
        return;
      }

      // pick up to 8 for module, 10 for review
      const pickN = moduleId==="review" ? 10 : Math.min(8, pool.length);
      const selected = [...pool].sort(()=>Math.random()-0.5).slice(0, pickN);

      let answers = {};
      let submitted = false;

      const body = `
        <div class="row" style="justify-content:space-between">
          <div class="badge"><b>Questions:</b> ${selected.length}</div>
          <div class="badge blue"><b>Time:</b> <span id="qtimer">00:00</span></div>
        </div>
        <div style="height:12px"></div>
        <div id="qwrap"></div>
        <div class="actions" style="margin-top:12px">
          <button class="btn good" id="qSubmit">Submit</button>
          <button class="btn" id="qNew">New set</button>
        </div>
        <div id="qResult" style="margin-top:12px"></div>
      `;

      showModal("Quiz", body);

      // timer
      const start = Date.now();
      const timerEl = document.getElementById("qtimer");
      const timer = setInterval(()=>{
        const sec = Math.floor((Date.now()-start)/1000);
        const mm = String(Math.floor(sec/60)).padStart(2,"0");
        const ss = String(sec%60).padStart(2,"0");
        timerEl.textContent = `${mm}:${ss}`;
      }, 250);

      const qwrap = document.getElementById("qwrap");

      selected.forEach((item, i)=>{
        const id = `q_${i}`;
        const box = document.createElement("div");
        box.className = "qbox";

        let html = `<h4>${i+1}. ${escapeHtml(item.q)}</h4>`;

        if(item.type==="mc"){
          html += item.options.map((opt, oi)=>`
            <label class="opt">
              <input type="radio" name="${id}" value="${oi}">
              <span>${escapeHtml(opt)}</span>
            </label>
          `).join("");
        } else if(item.type==="tf"){
          html += `
            <label class="opt"><input type="radio" name="${id}" value="true"><span>True</span></label>
            <label class="opt"><input type="radio" name="${id}" value="false"><span>False</span></label>
          `;
        } else {
          html += `<input class="pill" style="width:100%; border-radius:16px; padding:12px 14px; font-size:1rem" placeholder="Type your answer..." id="${id}_short">`;
        }

        html += `<div class="qmeta">
          <span class="badge orange"><b>Module:</b> ${escapeHtml(moduleLabel(item.m))}</span>
          <span class="badge blue"><b>Skill:</b> Retrieval</span>
        </div>`;

        box.innerHTML = html;
        qwrap.appendChild(box);
      });

      function readAnswers(){
        const out = {};
        selected.forEach((item,i)=>{
          const id = `q_${i}`;
          if(item.type==="mc"){
            const sel = document.querySelector(`input[name="${id}"]:checked`);
            out[i] = sel ? Number(sel.value) : null;
          }else if(item.type==="tf"){
            const sel = document.querySelector(`input[name="${id}"]:checked`);
            out[i] = sel ? (sel.value==="true") : null;
          }else{
            const v = (document.getElementById(`${id}_short`).value || "").trim().toLowerCase();
            out[i] = v.length ? v : null;
          }
        });
        return out;
      }

      function grade(){
        answers = readAnswers();
        let correct = 0;
        selected.forEach((item,i)=>{
          const user = answers[i];
          let ok = false;
          if(user===null){ ok = false; }
          else if(item.type==="mc"){ ok = (user === item.a); }
          else if(item.type==="tf"){ ok = (user === item.a); }
          else{
            const target = String(item.a).toLowerCase();
            ok = user.includes(target);
          }
          if(ok) correct++;
        });
        return {correct, total:selected.length, pct: Math.round((correct/selected.length)*100)};
      }

      document.getElementById("qSubmit").onclick = ()=>{
        if(submitted) return;
        submitted = true;

        const g = grade();
        clearInterval(timer);

        state.quizDone += 1;
        state.bestScore = (state.bestScore===null) ? g.pct : Math.max(state.bestScore, g.pct);
        saveState();

        // feedback per question
        const qboxes = qwrap.querySelectorAll(".qbox");
        selected.forEach((item,i)=>{
          const user = answers[i];
          let ok = false;
          if(user===null){ ok = false; }
          else if(item.type==="mc"){ ok = (user === item.a); }
          else if(item.type==="tf"){ ok = (user === item.a); }
          else{
            const target = String(item.a).toLowerCase();
            ok = user.includes(target);
          }

          const fb = document.createElement("div");
          fb.className = "feedback" + (ok ? "" : " bad");
          fb.innerHTML = ok
            ? `<b style="color:var(--good)">Correct.</b> ${escapeHtml(item.exp)}`
            : `<b style="color:var(--bad)">Not correct.</b> ${escapeHtml(item.exp)}`;
          qboxes[i].appendChild(fb);
        });

        document.getElementById("qResult").innerHTML = `
          <div class="soft ${g.pct>=70 ? "blue" : "orange"}">
            <b>Score:</b> ${g.correct}/${g.total} (${g.pct}%)
            <div class="tiny" style="margin-top:6px">Best score is tracked automatically.</div>
          </div>
        `;
        toastMsg(`Quiz saved: ${g.pct}%`);
      };

      document.getElementById("qNew").onclick = ()=>{
        closeModal();
        openQuiz(moduleId);
      };
    }

    /***********************
     * MIND MAP (Interactive SVG)
     ***********************/
    function openMindmap(moduleId){
      const map = buildMindMap(moduleId);
      showModal("Mind Map", map);
      wireMindMapClicks();
    }

    function buildMindMap(moduleId){
      const title = moduleId==="review" ? "Course Map" : moduleLabel(moduleId) + " Map";
      const nodes = getMapNodes(moduleId);

      // Simple layout presets
      const width = 980, height = 520;

      const svgNodes = nodes.map(n => `
        <g class="nodeBox" data-goto="${n.goto || ""}" data-note="${escapeHtml(n.note || "")}">
          <rect x="${n.x}" y="${n.y}" rx="16" ry="16" width="${n.w}" height="${n.h}"
                fill="rgba(255,255,255,.90)" stroke="rgba(15,42,27,.16)"/>
          <text class="nodeText" x="${n.x + 14}" y="${n.y + 28}">${escapeHtml(n.label)}</text>
          <text class="nodeText" x="${n.x + 14}" y="${n.y + 52}" style="opacity:.72; font-size:13px;">
            ${escapeHtml(n.sub || "")}
          </text>
        </g>
      `).join("");

      const svgLinks = nodes.flatMap(n => (n.links||[]).map(t => {
        const from = centerOf(n);
        const to = centerOf(nodes.find(x=>x.id===t));
        if(!to) return "";
        const midx = (from.cx + to.cx)/2;
        return `
          <path d="M ${from.cx} ${from.cy} C ${midx} ${from.cy}, ${midx} ${to.cy}, ${to.cx} ${to.cy}"
                fill="none" stroke="rgba(42,120,208,.38)" stroke-width="3" stroke-linecap="round"/>
        `;
      })).join("");

      return `
        <div class="row" style="justify-content:space-between">
          <div class="badge"><b>${escapeHtml(title)}</b></div>
          <div class="tiny">Click a node to open the linked module.</div>
        </div>
        <div style="height:12px"></div>
        <div class="map">
          <svg viewBox="0 0 ${width} ${height}" role="img" aria-label="Mind map">
            ${svgLinks}
            ${svgNodes}
          </svg>
        </div>
        <div style="height:10px"></div>
        <div class="soft blue" id="mapHint"><b>Note:</b> Click any node to navigate. Use this to connect concepts while revising.</div>
      `;
    }

    function centerOf(n){
      return {cx: n.x + n.w/2, cy: n.y + n.h/2};
    }

    function getMapNodes(moduleId){
      const base = [
        {id:"g", label:"Genres", sub:"fiction ‚Ä¢ drama ‚Ä¢ poetry ‚Ä¢ nonfiction", x:30, y:40, w:300, h:78, goto:"m1",
          note:"Genre is the broad category; use subgenre/kind for finer divisions.", links:["t","p","d","f"]},
        {id:"t", label:"Terms & Devices", sub:"simile ‚Ä¢ metaphor ‚Ä¢ imagery", x:360, y:30, w:290, h:78, goto:"m2",
          note:"Name the device and explain its effect.", links:["s"]},
        {id:"s", label:"Sound Devices", sub:"alliteration ‚Ä¢ rhythm ‚Ä¢ emphasis", x:680, y:44, w:270, h:70, goto:"m3",
          note:"Sound shapes memorability and tone.", links:["p"]},
        {id:"p", label:"Poetry", sub:"form ‚Ä¢ voice ‚Ä¢ theme ‚Ä¢ subgenres", x:70, y:170, w:290, h:86, goto:"m4",
          note:"Track pattern + sound + word choice.", links:["w"]},
        {id:"w", label:"Close Reading", sub:"notice ‚Üí read aloud ‚Üí meanings", x:390, y:180, w:310, h:86, goto:"m5",
          note:"Translate vocabulary first, then interpret.", links:[]},
        {id:"d", label:"Drama", sub:"action ‚Ä¢ dialogue ‚Ä¢ performance", x:730, y:190, w:220, h:86, goto:"m6",
          note:"Stage movement and setting create meaning.", links:["tr"]},
        {id:"tr", label:"Trifles", sub:"domestic space as evidence", x:660, y:320, w:290, h:78, goto:"m7",
          note:"Use objects as evidence; question what is dismissed.", links:[]},
        {id:"f", label:"Fiction", sub:"POV ‚Ä¢ setting ‚Ä¢ symbolism ‚Ä¢ theme", x:80, y:320, w:320, h:86, goto:"m8",
          note:"Name POV and one effect; link setting to mood/character.", links:["pp"]},
        {id:"pp", label:"Pride & Prejudice", sub:"irony ‚Ä¢ class ‚Ä¢ marriage ‚Ä¢ change", x:430, y:340, w:300, h:86, goto:"m9",
          note:"Show how irony/dialogue creates critique.", links:[]},
      ];

      if(moduleId==="review") return base;

      // highlight-focused subset but keep connected map
      const allow = new Set(["home", moduleId, "review"]);
      // For a single module, still show full map because it helps revision.
      return base;
    }

    function wireMindMapClicks(){
      document.querySelectorAll(".nodeBox").forEach(el=>{
        el.addEventListener("click", ()=>{
          const goto = el.dataset.goto;
          const note = el.dataset.note;
          const hint = document.getElementById("mapHint");
          if(note && hint) hint.innerHTML = `<b>Note:</b> ${escapeHtml(note)}`;
          if(goto){
            closeModal();
            openModule(goto);
          }
        });
      });
    }

    /***********************
     * NOTES
     ***********************/
    function openNotes(moduleId){
      const key = moduleId==="review" ? state.lastModule : moduleId;
      const mod = modules.find(x=>x.id===key) || modules[0];
      const current = state.notes[key] || "";

      showModal("Notes", `
        <div class="row" style="justify-content:space-between">
          <div class="badge"><b>Module:</b> ${escapeHtml(mod.short)}</div>
          <div class="tiny">Saved automatically on close.</div>
        </div>
        <div style="height:12px"></div>

        <div class="soft">
          <b>Use this structure:</b>
          <ul class="list">
            <li><b>Claim:</b> one sentence.</li>
            <li><b>Evidence:</b> specific words/choices/structure.</li>
            <li><b>Effect:</b> what it makes the reader think/feel.</li>
            <li><b>Meaning:</b> link to theme/context.</li>
          </ul>
        </div>

        <div style="height:12px"></div>
        <textarea id="notesArea" style="width:100%; min-height:320px; font-size:1rem; line-height:1.5; padding:12px 14px; border-radius:18px; border:1px solid rgba(15,42,27,.12); background:rgba(255,255,255,.88); box-shadow: 0 10px 20px rgba(10,30,20,.06); outline:none;"
          placeholder="Write your notes here...">${escapeHtml(current)}</textarea>
        <div class="actions" style="margin-top:12px">
          <button class="btn good" id="saveNotesBtn">Save</button>
          <button class="btn" id="clearNotesBtn">Clear</button>
        </div>
      `);

      const area = document.getElementById("notesArea");
      document.getElementById("saveNotesBtn").onclick = ()=>{
        state.notes[key] = area.value;
        saveState();
        toastMsg("Notes saved");
      };
      document.getElementById("clearNotesBtn").onclick = ()=>{
        area.value = "";
        state.notes[key] = "";
        saveState();
        toastMsg("Notes cleared");
      };

      // auto-save on close
      const oldClose = document.getElementById("modalClose").onclick;
      document.getElementById("modalClose").onclick = ()=>{
        state.notes[key] = area.value;
        saveState();
        document.getElementById("modalClose").onclick = oldClose;
        closeModal();
      };
    }

    /***********************
     * GLOSSARY (searchable)
     ***********************/
    function openGlossary(){
      const all = flashcards.map((c, idx)=>({...c, idx}));
      showModal("Glossary", `
        <div class="row" style="justify-content:space-between">
          <div class="badge"><b>Entries:</b> ${all.length}</div>
          <div class="pill" style="min-width:260px">
            <span aria-hidden="true">üîé</span>
            <input id="glossSearch" placeholder="Search glossary (e.g., tone, apostrophe, setting)..." />
          </div>
        </div>
        <div style="height:12px"></div>
        <div id="glossList"></div>
      `);

      const list = document.getElementById("glossList");
      const input = document.getElementById("glossSearch");

      function render(filter=""){
        const f = filter.trim().toLowerCase();
        const items = all.filter(x=>{
          if(!f) return true;
          return (x.term+" "+x.def+" "+x.m+" "+(x.tag||"")).toLowerCase().includes(f);
        }).slice(0, 80);

        list.innerHTML = items.map(x=>`
          <div class="qbox">
            <h4>${escapeHtml(x.term)} <span class="tiny">(${escapeHtml(moduleLabel(x.m))})</span></h4>
            <div class="tiny" style="margin-bottom:8px">Tag: ${escapeHtml(x.tag || "‚Äî")}</div>
            <div>${escapeHtml(x.def)}</div>
          </div>
        `).join("") || `<div class="soft orange"><b>No matches.</b></div>`;
      }

      input.oninput = ()=> render(input.value);
      render("");
      input.focus();
    }

    /***********************
     * GLOBAL SEARCH
     ***********************/
    const globalSearch = document.getElementById("globalSearch");
    globalSearch.addEventListener("keydown", (e)=>{
      if(e.key==="Enter"){
        const q = globalSearch.value.trim().toLowerCase();
        if(!q) return;
        const hits = searchAll(q);
        showModal("Search Results", renderSearchResults(q, hits));
      }
    });

    function searchAll(q){
      const hits = [];

      modules.forEach(m=>{
        const blob = [
          m.title, m.kicker,
          ...(m.learn||[]).flatMap(b=>[b.heading, ...(b.text||[])])
        ].join(" ").toLowerCase();
        if(blob.includes(q)) hits.push({type:"Module", where:m.short, title:m.title, goto:m.id});
      });

      flashcards.forEach((c, i)=>{
        const blob = (c.term+" "+c.def+" "+(c.tag||"")).toLowerCase();
        if(blob.includes(q)) hits.push({type:"Glossary", where:moduleLabel(c.m), title:c.term, goto:c.m, extra:c.def});
      });

      quizzes.forEach((x,i)=>{
        const blob = (x.q+" "+(x.exp||"")).toLowerCase();
        if(blob.includes(q)) hits.push({type:"Quiz", where:moduleLabel(x.m), title:x.q, goto:x.m});
      });

      return hits.slice(0, 60);
    }

    function renderSearchResults(q, hits){
      if(!hits.length){
        return `<div class="soft orange"><b>No results</b> for ‚Äú${escapeHtml(q)}‚Äù.</div>`;
      }
      return `
        <div class="badge"><b>Results:</b> ${hits.length}</div>
        <div style="height:12px"></div>
        ${hits.map(h=>`
          <div class="qbox">
            <div class="row" style="justify-content:space-between">
              <b>${escapeHtml(h.title)}</b>
              <span class="badge blue"><b>${escapeHtml(h.type)}</b> ‚Ä¢ ${escapeHtml(h.where)}</span>
            </div>
            ${h.extra ? `<div class="tiny" style="margin-top:8px">${escapeHtml(h.extra)}</div>` : ""}
            <div class="actions" style="margin-top:10px">
              <button class="btn primary" data-goto="${escapeHtml(h.goto)}">Open</button>
            </div>
          </div>
        `).join("")}
      `;
    }

    // wire open buttons after modal render
    modal.addEventListener("click", (e)=>{
      const t = e.target;
      if(t && t.dataset && t.dataset.goto){
        closeModal();
        openModule(t.dataset.goto);
      }
    });

    /***********************
     * QUICK ACTIONS
     ***********************/
    document.getElementById("quickQuizBtn").onclick = ()=> openQuiz("review");
    document.getElementById("quickCardsBtn").onclick = ()=> openFlashcards("review");
    document.getElementById("glossaryBtn").onclick = openGlossary;
    document.getElementById("mindmapBtn").onclick = ()=> openMindmap("review");
    document.getElementById("notesBtn").onclick = ()=> openNotes("review");

    document.getElementById("resetBtn").onclick = ()=>{
      const keep = {focus: state.focus};
      const fresh = freshState();
      Object.assign(state, fresh, keep);
      saveState();
      openModule("home");
      toastMsg("Progress reset");
    };

    /***********************
     * FOCUS MODE
     ***********************/
    document.getElementById("focusBtn").onclick = ()=>{
      state.focus = !state.focus;
      document.body.style.filter = state.focus ? "saturate(1.04) contrast(1.02)" : "none";
      document.querySelector("aside.widget").style.display = state.focus ? "none" : "flex";
      document.querySelector(".grid").style.gridTemplateColumns = state.focus ? "1fr" : "";
      saveState();
      toastMsg(state.focus ? "Focus mode on" : "Focus mode off");
    };

    /***********************
     * AMBIENT AUDIO (WebAudio)
     * - no external files
     * - starts only after a click (browser policy)
     ***********************/
    let audioOn = false;
    let audioCtx = null;
    let nodes = null;

    function startAudio(){
      if(audioOn) return;
      audioOn = true;

      audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      // soft pad: two oscillators + slow LFO
      const o1 = audioCtx.createOscillator();
      const o2 = audioCtx.createOscillator();
      o1.type = "sine";
      o2.type = "triangle";
      o1.frequency.value = 110;
      o2.frequency.value = 220;

      const g = audioCtx.createGain();
      g.gain.value = 0.0;

      const lfo = audioCtx.createOscillator();
      lfo.type = "sine";
      lfo.frequency.value = 0.08;

      const lfoGain = audioCtx.createGain();
      lfoGain.gain.value = 0.06;

      // noise (wind)
      const noise = audioCtx.createBufferSource();
      const bufferSize = audioCtx.sampleRate * 2;
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0; i<bufferSize; i++) data[i] = (Math.random()*2 - 1) * 0.20;
      noise.buffer = buffer;
      noise.loop = true;

      const noiseFilter = audioCtx.createBiquadFilter();
      noiseFilter.type = "lowpass";
      noiseFilter.frequency.value = 650;

      const noiseGain = audioCtx.createGain();
      noiseGain.gain.value = 0.0;

      // master
      const master = audioCtx.createGain();
      master.gain.value = 0.65;

      // routing
      lfo.connect(lfoGain);
      lfoGain.connect(g.gain);

      o1.connect(g);
      o2.connect(g);

      noise.connect(noiseFilter);
      noiseFilter.connect(noiseGain);

      const mix = audioCtx.createGain();
      mix.gain.value = 0.9;

      g.connect(mix);
      noiseGain.connect(mix);

      mix.connect(master);
      master.connect(audioCtx.destination);

      // start
      o1.start();
      o2.start();
      lfo.start();
      noise.start();

      // fade in
      g.gain.linearRampToValueAtTime(0.045, audioCtx.currentTime + 1.5);
      noiseGain.gain.linearRampToValueAtTime(0.020, audioCtx.currentTime + 1.5);

      nodes = {o1,o2,lfo,noise,g,noiseGain,master,noiseFilter,mix};

      document.getElementById("musicBtn").textContent = "‚è∏Ô∏é Audio";
      toastMsg("Audio on");
    }

    function stopAudio(){
      if(!audioOn) return;
      audioOn = false;
      try{
        const now = audioCtx.currentTime;
        nodes.g.gain.linearRampToValueAtTime(0.0, now + 0.6);
        nodes.noiseGain.gain.linearRampToValueAtTime(0.0, now + 0.6);
        setTimeout(()=>{
          try{
            nodes.o1.stop(); nodes.o2.stop(); nodes.lfo.stop(); nodes.noise.stop();
            audioCtx.close();
          }catch(e){}
          audioCtx = null;
          nodes = null;
        }, 800);
      }catch(e){}
      document.getElementById("musicBtn").textContent = "‚ñ∂Ô∏é Audio";
      toastMsg("Audio off");
    }

    document.getElementById("musicBtn").onclick = ()=>{
      if(!audioOn) startAudio();
      else stopAudio();
    };

    /***********************
     * INIT
     ***********************/
    buildTabs();
    renderStats();
    openModule(state.lastModule || "home");
  </script>
</body>
</html>

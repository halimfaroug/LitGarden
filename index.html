<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ENGL280: An Introduction to Literature — Interactive Study Platform</title>

  <style>
    :root{
      --sky1:#e6fbff;
      --sky2:#eafcf1;
      --sky3:#fff7e6;

      --ink:#0b1b13;
      --muted:rgba(11,27,19,.72);

      --glass:rgba(255,255,255,.80);
      --stroke:rgba(11,27,19,.14);

      --accent:#00a3ff;
      --accent2:#22c55e;
      --accent3:#ffd166;

      --danger:#ff4d4d;
      --ok:#16a34a;

      --radius:18px;
      --shadow: 0 14px 46px rgba(11,27,19,.12);
      --shadow2: 0 10px 26px rgba(11,27,19,.10);

      /* Larger, readable typography */
      --base: 22px;
      --h1: 42px;
      --h2: 32px;
      --h3: 24px;

      /* Good-looking, offline-safe font stack */
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      font-family: var(--font);
      font-size: var(--base);
      line-height: 1.6;
      color: var(--ink);
      margin: 0;
      overflow-x: hidden;

      background:
        radial-gradient(1100px 700px at 10% 10%, rgba(0,163,255,.18), transparent 60%),
        radial-gradient(1000px 700px at 90% 15%, rgba(34,197,94,.16), transparent 58%),
        radial-gradient(900px 650px at 60% 95%, rgba(255,209,102,.15), transparent 60%),
        linear-gradient(180deg, var(--sky1), var(--sky2), var(--sky3));
    }

    /* Animated nature background (offline) */
    #bgCanvas{
      position: fixed;
      inset: 0;
      z-index: -2;
      width: 100%;
      height: 100%;
    }
    .vignette{
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events:none;
      background:
        radial-gradient(900px 700px at 50% -10%, rgba(255,255,255,.92), transparent 62%),
        radial-gradient(900px 700px at 10% 60%, rgba(0,163,255,.10), transparent 60%),
        radial-gradient(900px 700px at 90% 70%, rgba(34,197,94,.10), transparent 60%);
    }

    header{
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(90deg, rgba(255,255,255,.88), rgba(255,255,255,.70));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--stroke);
      box-shadow: 0 8px 24px rgba(11,27,19,.08);
    }

    .headerInner{
      max-width: 1250px;
      margin: 0 auto;
      padding: 16px 18px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 14px;
      align-items: center;
    }

    .titleBlock h1{
      font-size: var(--h1);
      margin: 0;
      letter-spacing: .2px;
      line-height: 1.1;
    }
    .titleBlock .subline{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 18px;
    }
    .developerLine{
      margin: 6px 0 0;
      color: rgba(11,27,19,.62);
      font-size: 16px;
    }

    nav{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
      align-items:center;
    }
    nav button, .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.78);
      color: var(--ink);
      padding: 12px 14px;
      border-radius: 14px;
      cursor: pointer;
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
      box-shadow: var(--shadow2);
      font-size: 16px;
      user-select:none;
    }
    nav button:hover, .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.94);
      border-color: rgba(0,163,255,.30);
    }
    nav button.active{
      background: linear-gradient(90deg, rgba(0,163,255,.16), rgba(34,197,94,.10));
      border-color: rgba(34,197,94,.35);
    }

    main{
      max-width: 1250px;
      margin: 0 auto;
      padding: 18px;
      padding-bottom: 120px;
    }

    section{ display:none; margin-top: 16px; }
    section.active{ display:block; }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:start;
    }

    .card{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.80);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding: 14px 16px;
      border-bottom: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.66));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .cardHeader h2, .cardHeader h3{ margin:0; }
    h2{ font-size: var(--h2); }
    h3{ font-size: var(--h3); margin: 12px 0 8px; }
    .cardBody{ padding: 16px; }

    p{ margin: 10px 0; }

    .pillRow{ display:flex; flex-wrap:wrap; gap:10px; }
    .pill{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.76);
      font-size: 14px;
      color: var(--muted);
      box-shadow: 0 8px 18px rgba(11,27,19,.06);
    }

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin: 10px 0 0;
    }
    .toolbar .left, .toolbar .right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn.primary{
      border-color: rgba(0,163,255,.35);
      background: linear-gradient(90deg, rgba(0,163,255,.18), rgba(34,197,94,.10));
    }
    .btn.danger{
      border-color: rgba(255,77,77,.35);
      background: rgba(255,77,77,.10);
    }

    .callout{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(11,27,19,.12);
      background: rgba(255,255,255,.62);
      color: rgba(11,27,19,.78);
      font-size: 18px;
      line-height: 1.55;
      margin: 12px 0;
    }

    /* Flashcards */
    .flashWrap{ display:grid; gap:12px; }
    .flashcard{
      min-height: 280px;
      border-radius: 20px;
      border: 1px solid var(--stroke);
      background:
        radial-gradient(900px 320px at 20% 10%, rgba(0,163,255,.18), transparent 60%),
        radial-gradient(900px 320px at 80% 20%, rgba(34,197,94,.16), transparent 55%),
        radial-gradient(900px 320px at 60% 95%, rgba(255,209,102,.12), transparent 55%),
        rgba(255,255,255,.84);
      box-shadow: var(--shadow);
      padding: 16px;
      cursor: pointer;
      user-select:none;
      transition: transform .14s ease, border-color .18s ease;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      overflow:hidden;
    }
    .flashcard:hover{ transform: translateY(-2px); border-color: rgba(0,163,255,.35); }
    .flashFront{
      font-size: 40px;
      font-weight: 900;
      letter-spacing:.2px;
      line-height: 1.15;
    }
    .flashBack{
      display:none;
      margin-top: 14px;
      font-size: 24px;
      color: rgba(11,27,19,.74);
      line-height: 1.6;
      font-weight: 550;
    }
    .flashcard.flipped .flashBack{ display:block; }

    .statusRow{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .statusBtn{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.88);
      cursor:pointer;
      font-size: 14px;
      box-shadow: 0 8px 18px rgba(11,27,19,.05);
    }
    .statusBtn.active{ border-color: rgba(34,197,94,.45); background: rgba(34,197,94,.14); }

    /* Quiz */
    .quiz-question{
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.82);
      box-shadow: 0 10px 24px rgba(11,27,19,.06);
      margin-bottom: 12px;
    }
    .quiz-question p{ margin: 0 0 10px; font-weight: 800; }
    .opt{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.72);
      margin-top: 8px;
      cursor:pointer;
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
    }
    .opt:hover{ transform: translateY(-1px); background: rgba(255,255,255,.92); border-color: rgba(0,163,255,.25); }
    .opt input{ transform: scale(1.25); margin-top: 4px; }

    .feedback{
      margin-top: 10px;
      font-size: 17px;
      line-height: 1.55;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.72);
    }
    .good{ border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.10); }
    .bad{ border-color: rgba(255,77,77,.35); background: rgba(255,77,77,.10); }

    /* Matching */
    .matchGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .zone{
      border:2px dashed rgba(0,163,255,.25);
      background: rgba(0,163,255,.06);
      border-radius: 16px;
      padding: 12px;
      min-height: 220px;
    }
    .draggable{
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.90);
      box-shadow: 0 10px 24px rgba(11,27,19,.05);
      cursor: grab;
      user-select:none;
      margin-top: 10px;
      font-size: 18px;
    }
    .dropDef{
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.78);
      margin-top: 10px;
      min-height: 74px;
    }

    /* Mind maps */
    .mindmap{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.84);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 24px rgba(11,27,19,.06);
      margin-bottom: 12px;
    }
    .node{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: linear-gradient(90deg, rgba(34,197,94,.12), rgba(0,163,255,.10));
      cursor:pointer;
      font-weight: 900;
      display:inline-block;
      margin: 6px 0;
      transition: transform .12s ease;
    }
    .node:hover{ transform: translateY(-1px); }
    .child{
      display:none;
      margin: 8px 0 0 10px;
      padding-left: 12px;
      border-left: 2px solid rgba(34,197,94,.25);
      color: var(--muted);
      font-weight: 600;
      font-size: 18px;
    }
    .expanded .child{ display:block; }

    footer{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: linear-gradient(90deg, rgba(255,255,255,.88), rgba(255,255,255,.70));
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--stroke);
      box-shadow: 0 -8px 24px rgba(11,27,19,.08);
      padding: 10px 14px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      z-index: 10;
    }
    footer p{ margin:0; color: var(--muted); font-size: 15px; }

    .meter{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      font-size: 14px;
      color: var(--muted);
    }
    .bar{
      width: 220px; height: 12px;
      border-radius: 999px;
      background: rgba(11,27,19,.08);
      overflow:hidden;
      border: 1px solid rgba(11,27,19,.10);
    }
    .bar > div{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(0,163,255,.90), rgba(34,197,94,.80), rgba(255,209,102,.70));
      border-radius: 999px;
      transition: width .35s ease;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      nav{ justify-content:flex-start; }
      .bar{ width: 180px; }
    }
  </style>
</head>

<body>
  <canvas id="bgCanvas" aria-hidden="true"></canvas>
  <div class="vignette" aria-hidden="true"></div>

  <header>
    <div class="headerInner">
      <div class="titleBlock">
        <h1>ENGL280: An Introduction to Literature</h1>
        <div class="subline">Study materials, practice activities, and revision tools for the full course.</div>
        <div class="developerLine">Developed by: <b>Halim Faroug A. Elhag, Lecturer, UHB / UofK</b></div>
      </div>
      <nav id="navBar"></nav>
    </div>
  </header>

  <main>
    <!-- HOME -->
    <section id="home" class="active">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Course Overview</h2>
            <div class="pillRow">
              <span class="pill">Poetry</span>
              <span class="pill">Drama</span>
              <span class="pill">Fiction</span>
              <span class="pill">Literary Terms</span>
            </div>
          </div>
          <div class="cardBody">
            <p>This platform supports ENGL280 through structured modules and practice activities. Students can study key concepts, review terms, and test understanding through guided practice.</p>
            <div class="callout">
              Use the module tabs to study the lesson content. In each module, open the practice area to review key terms, complete short questions, and revise with summary maps.
            </div>
            <p id="clockLine" class="callout" style="border-color: rgba(0,163,255,.20);"></p>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h3>Quick Access</h3>
          </div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showSection('module1')">Begin Module 1</button>
                <button class="btn" onclick="showSection('review')">Revision</button>
              </div>
              <div class="right">
                <button class="btn" id="musicBtn">Audio</button>
                <button class="btn danger" onclick="resetProgress()">Reset</button>
              </div>
            </div>

            <div class="pillRow" style="margin-top:12px;">
              <span class="pill" id="statPill">Score: 0</span>
              <span class="pill" id="fcPill">Mastered: 0 / 50</span>
              <span class="pill" id="qPill">Correct: 0 / 50</span>
            </div>

            <div class="callout" style="margin-top:12px;">
              Tap <b>Audio</b> once to start a calm background sound. Most browsers require a click to enable audio.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MODULES -->
    <section id="module1">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 1: Introduction to Literature & Its Genres</h2>
            <div class="pillRow"><span class="pill">Definition</span><span class="pill">Function</span><span class="pill">Classification</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>Literature is studied as an art of language: it represents human experience and shapes meaning through style and form.</p>
            <p><b>Key focus:</b> What literature is, what it does, and how it is classified.</p>
            <p><b>Major genres:</b> Poetry, Drama, Fiction.</p>
            <p><b>Reasons to study literature:</b> analytical reading, argumentation, cultural literacy, language awareness, and empathy.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(1)">Terms</button>
                <button class="btn primary" onclick="showQuiz(1)">Questions</button>
                <button class="btn" onclick="showMatching(1)">Matching</button>
                <button class="btn" onclick="showMindMap(1)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module2')">Next</button>
              </div>
            </div>
            <div id="m1Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module2">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 2: Basic Literary Terms</h2>
            <div class="pillRow"><span class="pill">Meaning</span><span class="pill">Comparison</span><span class="pill">Imagery</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p><b>Figure of speech:</b> a word or phrase used beyond its literal meaning to create effect.</p>
            <p><b>Simile:</b> comparison using <i>like/as</i>. <b>Metaphor:</b> direct comparison without <i>like/as</i>.</p>
            <p><b>Analogy:</b> comparison used to explain an unfamiliar concept.</p>
            <p><b>Imagery:</b> sensory description. <b>Personification:</b> giving human qualities to non-human things. <b>Onomatopoeia:</b> sound-imitating words.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(2)">Terms</button>
                <button class="btn primary" onclick="showQuiz(2)">Questions</button>
                <button class="btn" onclick="showMatching(2)">Matching</button>
                <button class="btn" onclick="showMindMap(2)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module3')">Next</button>
              </div>
            </div>
            <div id="m2Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module3">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 3: Figures of Speech & Sound Devices</h2>
            <div class="pillRow"><span class="pill">Style</span><span class="pill">Sound</span><span class="pill">Effect</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>Literary style draws on meaning devices (figures) and sound devices (music/texture).</p>
            <p><b>Sound devices:</b> alliteration, assonance, consonance, rhyme, rhythm, onomatopoeia.</p>
            <p><b>Figures:</b> metaphor, symbol, irony, hyperbole, understatement, allusion.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(3)">Terms</button>
                <button class="btn primary" onclick="showQuiz(3)">Questions</button>
                <button class="btn" onclick="showMatching(3)">Matching</button>
                <button class="btn" onclick="showMindMap(3)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module4')">Next</button>
              </div>
            </div>
            <div id="m3Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module4">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 4: Poetry and Major Aspects of a Poem</h2>
            <div class="pillRow"><span class="pill">Rhythm</span><span class="pill">Form</span><span class="pill">Voice</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>Poetry uses patterned language to intensify feeling and meaning through rhythm, form, imagery, and sound.</p>
            <p><b>Major elements:</b> voice/speaker, diction, syntax, imagery, figures, sound, form, theme.</p>
            <p><b>Structure:</b> poems are organized into stanzas and lines.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(4)">Terms</button>
                <button class="btn primary" onclick="showQuiz(4)">Questions</button>
                <button class="btn" onclick="showMatching(4)">Matching</button>
                <button class="btn" onclick="showMindMap(4)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module5')">Next</button>
              </div>
            </div>
            <div id="m4Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module5">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 5: Sample Poetry — “Winter” (Shakespeare)</h2>
            <div class="pillRow"><span class="pill">Close Reading</span><span class="pill">Imagery</span><span class="pill">Sound</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>Close reading examines how meaning is produced through pattern: imagery, diction, sound texture, and contrast.</p>
            <p>In “Winter,” focus on seasonal imagery and contrasts (cold outside vs warmth inside) to build an interpretation.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(5)">Terms</button>
                <button class="btn primary" onclick="showQuiz(5)">Questions</button>
                <button class="btn" onclick="showMatching(5)">Matching</button>
                <button class="btn" onclick="showMindMap(5)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module6')">Next</button>
              </div>
            </div>
            <div id="m5Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module6">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 6: Drama and Major Aspects of a Play</h2>
            <div class="pillRow"><span class="pill">Performance</span><span class="pill">Dialogue</span><span class="pill">Conflict</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>Drama is written for performance. Meaning is produced through dialogue, stage directions, and audience effect.</p>
            <p><b>Classical structure:</b> prologue → episodes → stasimon → exodos.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(6)">Terms</button>
                <button class="btn primary" onclick="showQuiz(6)">Questions</button>
                <button class="btn" onclick="showMatching(6)">Matching</button>
                <button class="btn" onclick="showMindMap(6)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module7')">Next</button>
              </div>
            </div>
            <div id="m6Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module7">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 7: Sample Play — Trifles (Susan Glaspell)</h2>
            <div class="pillRow"><span class="pill">Evidence</span><span class="pill">Inference</span><span class="pill">Subtext</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>“Trifles” develops meaning through domestic detail. Students practice identifying evidence and drawing inferences.</p>
            <p>Focus on who notices what, how conclusions are formed, and how subtext shapes the moral logic of the play.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(7)">Terms</button>
                <button class="btn primary" onclick="showQuiz(7)">Questions</button>
                <button class="btn" onclick="showMatching(7)">Matching</button>
                <button class="btn" onclick="showMindMap(7)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module8')">Next</button>
              </div>
            </div>
            <div id="m7Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module8">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 8: Fiction and Major Aspects of Fiction</h2>
            <div class="pillRow"><span class="pill">Plot</span><span class="pill">Character</span><span class="pill">Point of View</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>Fiction presents invented characters and events, organized to create meaning and effect.</p>
            <p><b>By length:</b> novel, novella, short story.</p>
            <p><b>Core elements:</b> plot, character, setting, point of view, theme.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(8)">Terms</button>
                <button class="btn primary" onclick="showQuiz(8)">Questions</button>
                <button class="btn" onclick="showMatching(8)">Matching</button>
                <button class="btn" onclick="showMindMap(8)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('module9')">Next</button>
              </div>
            </div>
            <div id="m8Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="module9">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Module 9: Sample Novel — Pride & Prejudice (Jane Austen)</h2>
            <div class="pillRow"><span class="pill">Irony</span><span class="pill">Class</span><span class="pill">Social Critique</span></div>
          </div>
          <div class="cardBody">
            <h3>Lesson</h3>
            <p>“Pride and Prejudice” uses irony to examine social class, reputation, and marriage as an economic and moral system.</p>
            <p>Focus on narrative voice, dialogue, social codes, and how irony shapes interpretation.</p>
          </div>
        </div>
        <div class="card">
          <div class="cardHeader"><h3>Practice</h3></div>
          <div class="cardBody">
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showFlashcards(9)">Terms</button>
                <button class="btn primary" onclick="showQuiz(9)">Questions</button>
                <button class="btn" onclick="showMatching(9)">Matching</button>
                <button class="btn" onclick="showMindMap(9)">Map</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('review')">Revision</button>
              </div>
            </div>
            <div id="m9Practice"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- REVIEW -->
    <section id="review">
      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <h2>Revision</h2>
            <div class="pillRow">
              <span class="pill">Terms</span>
              <span class="pill">Questions</span>
              <span class="pill">Maps</span>
            </div>
          </div>
          <div class="cardBody">
            <p>This section consolidates course material for final revision.</p>
            <div class="toolbar">
              <div class="left">
                <button class="btn primary" onclick="showAllMindMaps()">Maps</button>
                <button class="btn primary" onclick="showAllQuizzes()">Questions</button>
                <button class="btn primary" onclick="showAllFlashcards()">Terms</button>
              </div>
              <div class="right">
                <button class="btn" onclick="showSection('home')">Overview</button>
              </div>
            </div>
            <div id="reviewArea"></div>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader"><h3>Progress</h3></div>
          <div class="cardBody">
            <div class="pillRow">
              <span class="pill" id="reviewMastered">Mastered: 0 / 50</span>
              <span class="pill" id="reviewCorrect">Correct: 0 / 50</span>
            </div>
            <div class="callout" style="border-color: rgba(255,209,102,.25);">
              Recommended sequence: revise terms → complete questions → confirm understanding with maps.
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>ENGL280 — Interactive Study Platform</p>
    <div class="meter">
      <span><b>Score:</b> <span id="scoreVal">0</span></span>
      <div class="bar" title="Overall progress"><div id="progressFill"></div></div>
    </div>
  </footer>

  <script>
    /* Navigation */
    const moduleIds = ["home","module1","module2","module3","module4","module5","module6","module7","module8","module9","review"];
    const navLabels = { home:"Overview", module1:"M1", module2:"M2", module3:"M3", module4:"M4", module5:"M5", module6:"M6", module7:"M7", module8:"M8", module9:"M9", review:"Revision" };

    const navBar = document.getElementById("navBar");
    function buildNav(){
      navBar.innerHTML = "";
      moduleIds.forEach(id=>{
        const b = document.createElement("button");
        b.textContent = navLabels[id];
        b.onclick = ()=>showSection(id);
        b.id = "nav_"+id;
        navBar.appendChild(b);
      });
    }
    buildNav();

    function showSection(id){
      document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
      const el = document.getElementById(id);
      if (el) el.classList.add("active");
      moduleIds.forEach(mid=>{
        const nb = document.getElementById("nav_"+mid);
        if (nb) nb.classList.toggle("active", mid===id);
      });
    }

    /* Clock */
    function updateClock(){
      const now = new Date();
      const clockLine = document.getElementById("clockLine");
      if (clockLine) clockLine.textContent = "Current time: " + now.toLocaleString();
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* Progress state */
    const STORE = "ENGL280_PLATFORM_V3";
    const state = loadState();
    function loadState(){
      try{
        const raw = localStorage.getItem(STORE);
        if (!raw) return { score:0, mastered:{}, correct:{}, musicOn:false };
        const s = JSON.parse(raw);
        return { score:s.score||0, mastered:s.mastered||{}, correct:s.correct||{}, musicOn:!!s.musicOn };
      } catch {
        return { score:0, mastered:{}, correct:{}, musicOn:false };
      }
    }
    function saveState(){ localStorage.setItem(STORE, JSON.stringify(state)); updateStats(); }
    function resetProgress(){
      if (!confirm("Reset all saved progress?")) return;
      localStorage.removeItem(STORE);
      localStorage.removeItem(STORE+"_maps");
      location.reload();
    }

    function exploredMindMapsCount(){
      const raw = localStorage.getItem(STORE+"_maps");
      if (!raw) return 0;
      try{ return Object.keys(JSON.parse(raw)).length; }catch{ return 0; }
    }
    function markMindMapExplored(id){
      const key = STORE+"_maps";
      let obj = {};
      try{ obj = JSON.parse(localStorage.getItem(key)||"{}"); }catch{}
      obj[id] = true;
      localStorage.setItem(key, JSON.stringify(obj));
      updateStats();
    }

    function updateStats(){
      const masteredCount = Object.values(state.mastered).filter(v=>v==="mastered").length;
      const correctCount  = Object.values(state.correct).filter(Boolean).length;
      state.score = masteredCount + correctCount;

      const statPill = document.getElementById("statPill");
      const fcPill = document.getElementById("fcPill");
      const qPill = document.getElementById("qPill");
      if (statPill) statPill.textContent = `Score: ${state.score}`;
      if (fcPill) fcPill.textContent = `Mastered: ${masteredCount} / 50`;
      if (qPill) qPill.textContent = `Correct: ${correctCount} / 50`;

      const reviewMastered = document.getElementById("reviewMastered");
      const reviewCorrect = document.getElementById("reviewCorrect");
      if (reviewMastered) reviewMastered.textContent = `Mastered: ${masteredCount} / 50`;
      if (reviewCorrect) reviewCorrect.textContent = `Correct: ${correctCount} / 50`;

      const scoreVal = document.getElementById("scoreVal");
      if (scoreVal) scoreVal.textContent = state.score;

      const total = 125; // 50 terms + 50 questions + 25 maps
      const maps = exploredMindMapsCount();
      const progress = Math.round(((masteredCount + correctCount + maps) / total) * 100);
      const fill = document.getElementById("progressFill");
      if (fill) fill.style.width = `${Math.min(100, progress)}%`;
    }

    /* Data: 50 terms */
    const flashcards = [
      { id:"fc1", module:1, term:"Literature", definition:"Language shaped for meaning, experience, and effect." },
      { id:"fc2", module:1, term:"Genre", definition:"A category of writing with recognizable conventions (poetry, drama, fiction)." },
      { id:"fc3", module:1, term:"Theme", definition:"A central idea or insight developed by the text." },
      { id:"fc4", module:1, term:"Interpretation", definition:"A claim about meaning supported by evidence and explanation." },
      { id:"fc5", module:1, term:"Convention", definition:"A typical feature expected in a genre." },
      { id:"fc6", module:1, term:"Critical Reading", definition:"Analytical reading that explains how meaning is created." },

      { id:"fc7", module:2, term:"Figure of Speech", definition:"Non-literal language used for rhetorical or vivid effect." },
      { id:"fc8", module:2, term:"Denotation", definition:"A word’s dictionary meaning." },
      { id:"fc9", module:2, term:"Connotation", definition:"A word’s associations and implied meanings." },
      { id:"fc10", module:2, term:"Simile", definition:"Comparison using 'like' or 'as'." },
      { id:"fc11", module:2, term:"Metaphor", definition:"Direct comparison without 'like/as'." },
      { id:"fc12", module:2, term:"Analogy", definition:"Comparison used to explain an unfamiliar concept." },
      { id:"fc13", module:2, term:"Imagery", definition:"Sensory description appealing to sight, sound, touch, taste, and smell." },
      { id:"fc14", module:2, term:"Personification", definition:"Giving human qualities to non-human things." },
      { id:"fc15", module:2, term:"Onomatopoeia", definition:"Words that imitate sounds (buzz, hiss, tick)." },

      { id:"fc16", module:3, term:"Alliteration", definition:"Repetition of initial consonant sounds." },
      { id:"fc17", module:3, term:"Assonance", definition:"Repetition of vowel sounds." },
      { id:"fc18", module:3, term:"Consonance", definition:"Repetition of consonant sounds within/at ends of words." },
      { id:"fc19", module:3, term:"Rhyme", definition:"Matching sounds, often at line ends." },
      { id:"fc20", module:3, term:"Rhythm", definition:"Beat/flow created by stressed and unstressed syllables." },
      { id:"fc21", module:3, term:"Symbol", definition:"An object/action that represents more than itself." },
      { id:"fc22", module:3, term:"Irony", definition:"Contrast between expectation and reality, or stated vs intended meaning." },
      { id:"fc23", module:3, term:"Hyperbole", definition:"Deliberate exaggeration for emphasis." },
      { id:"fc24", module:3, term:"Understatement", definition:"Deliberately downplaying for effect." },
      { id:"fc25", module:3, term:"Allusion", definition:"Brief reference to a known text/event/person to add meaning." },

      { id:"fc26", module:4, term:"Speaker", definition:"The voice/persona speaking in a poem (not necessarily the poet)." },
      { id:"fc27", module:4, term:"Stanza", definition:"A grouped set of lines in a poem." },
      { id:"fc28", module:4, term:"Line", definition:"A single row of words in a poem; unit of rhythm/meaning." },
      { id:"fc29", module:4, term:"Meter", definition:"Pattern of stressed/unstressed syllables." },
      { id:"fc30", module:4, term:"Diction", definition:"Word choice and its effect." },
      { id:"fc31", module:4, term:"Syntax", definition:"Word order; can create emphasis or surprise." },
      { id:"fc32", module:4, term:"Form", definition:"Overall structure/pattern of a poem." },

      { id:"fc33", module:5, term:"Close Reading", definition:"Careful analysis of language patterns to explain effect and meaning." },
      { id:"fc34", module:5, term:"Contrast", definition:"Opposition (cold/warm, harsh/soft) used to sharpen meaning." },
      { id:"fc35", module:5, term:"Tone", definition:"Attitude conveyed by the voice and style." },

      { id:"fc36", module:6, term:"Dialogue", definition:"Character speech; main vehicle of action in drama." },
      { id:"fc37", module:6, term:"Stage Directions", definition:"Performance instructions: setting, movement, tone, props." },
      { id:"fc38", module:6, term:"Conflict", definition:"Central struggle driving plot and tension." },
      { id:"fc39", module:6, term:"Exodos", definition:"Final section of Greek tragedy; concluding exit scene." },

      { id:"fc40", module:7, term:"Evidence", definition:"Details that support an interpretation." },
      { id:"fc41", module:7, term:"Inference", definition:"A conclusion drawn from evidence." },
      { id:"fc42", module:7, term:"Subtext", definition:"Meaning implied beneath what is spoken." },

      { id:"fc43", module:8, term:"Plot", definition:"Events arranged with causality; the structure of action." },
      { id:"fc44", module:8, term:"Setting", definition:"Time/place/social world shaping characters and meaning." },
      { id:"fc45", module:8, term:"Point of View", definition:"Who tells the story; controls information and perspective." },

      { id:"fc46", module:9, term:"Irony (Austen)", definition:"Narrative strategy used to critique social norms and assumptions." },
      { id:"fc47", module:9, term:"Satire", definition:"Critique through humor, irony, or exaggeration." },
      { id:"fc48", module:9, term:"Narrator", definition:"Voice that tells the story; may be reliable or unreliable." },
      { id:"fc49", module:9, term:"Social Class", definition:"Hierarchy shaping behavior, opportunities, and conflict." },
      { id:"fc50", module:9, term:"Theme (Austen)", definition:"Meaning built through irony, dialogue, and social observation." },
    ];

    /* Data: 50 questions */
    const quizzes = [
      { id:"q1", module:1, question:"Literature is best described as…", type:"multiple", options:["Language shaped for meaning/effect","Scientific data","Only poetry","Only drama"], answer:"Language shaped for meaning/effect", explanation:"Literature uses language artistically to create meaning and effect." },
      { id:"q2", module:1, question:"Which is NOT a major genre?", type:"multiple", options:["Poetry","Drama","Fiction","Algebra"], answer:"Algebra", explanation:"Algebra is not a literary genre." },
      { id:"q3", module:1, question:"An interpretation should be supported by…", type:"multiple", options:["Evidence from the text","Only opinion","A guess","The author’s photo"], answer:"Evidence from the text", explanation:"Interpretations require textual support." },
      { id:"q4", module:1, question:"Theme is best defined as…", type:"multiple", options:["A central idea/insight","A character name","A setting","A single word topic"], answer:"A central idea/insight", explanation:"Theme is an insight, not just a topic." },
      { id:"q5", module:1, question:"Genre conventions are…", type:"multiple", options:["Typical features readers expect","Proof of truth","Only grammar rules","Only about rhyme"], answer:"Typical features readers expect", explanation:"Conventions help readers recognize and interpret genre." },
      { id:"q6", module:1, question:"Literature study develops analytical reading.", type:"truefalse", options:["True","False"], answer:true, explanation:"It trains interpretation supported by evidence." },

      { id:"q7", module:2, question:"A simile compares using…", type:"multiple", options:["like/as","only rhyme","stage directions","footnotes"], answer:"like/as", explanation:"Similes use 'like' or 'as'." },
      { id:"q8", module:2, question:"Metaphor is…", type:"multiple", options:["Direct comparison","Comparison using like/as","Only sound","Only plot"], answer:"Direct comparison", explanation:"Metaphor compares directly without like/as." },
      { id:"q9", module:2, question:"Imagery appeals to…", type:"multiple", options:["The five senses","Only logic","Only memory","Only grammar"], answer:"The five senses", explanation:"Imagery is sensory description." },
      { id:"q10", module:2, question:"Personification gives…", type:"multiple", options:["Human traits to non-human things","Numbers to words","Settings to characters","Rhymes to plots"], answer:"Human traits to non-human things", explanation:"Personification humanizes the non-human." },
      { id:"q11", module:2, question:"Onomatopoeia is…", type:"multiple", options:["Sound-imitating words","A plot twist","A stanza form","A theme"], answer:"Sound-imitating words", explanation:"Onomatopoeia imitates real sounds." },
      { id:"q12", module:2, question:"Denotation refers to…", type:"multiple", options:["Dictionary meaning","Associations","Rhyme scheme","Narrator voice"], answer:"Dictionary meaning", explanation:"Denotation = literal meaning." },
      { id:"q13", module:2, question:"Connotation refers to…", type:"multiple", options:["Associations/feelings","Only dictionary meaning","Only rhythm","Only movement"], answer:"Associations/feelings", explanation:"Connotation = implied meaning." },
      { id:"q14", module:2, question:"A figure of speech is always literal.", type:"truefalse", options:["True","False"], answer:false, explanation:"Figures of speech are non-literal." },
      { id:"q15", module:2, question:"Which is a simile?", type:"multiple", options:["Her smile was as bright as the sun.","Time is a thief.","The wind whispered.","Buzz."], answer:"Her smile was as bright as the sun.", explanation:"Simile uses as/like." },
      { id:"q16", module:2, question:"Which is a metaphor?", type:"multiple", options:["Time is a thief.","As cold as ice.","The clock ticked.","The roses are red."], answer:"Time is a thief.", explanation:"Metaphor is direct comparison." },
      { id:"q17", module:2, question:"Analogy is mainly used to…", type:"multiple", options:["Explain an unfamiliar concept","Create rhyme","List facts","Give directions"], answer:"Explain an unfamiliar concept", explanation:"Analogy compares to clarify." },
      { id:"q18", module:2, question:"Define imagery (short).", type:"short", answer:"sensory", explanation:"Imagery is sensory language." },

      { id:"q19", module:3, question:"Alliteration is repetition of…", type:"multiple", options:["Initial consonant sounds","Initial vowel sounds","Plot events","Character names"], answer:"Initial consonant sounds", explanation:"Alliteration repeats initial consonants." },
      { id:"q20", module:3, question:"Assonance is repetition of…", type:"multiple", options:["Vowel sounds","Only consonants","Punctuation","Imagery"], answer:"Vowel sounds", explanation:"Assonance repeats vowel sounds." },
      { id:"q21", module:3, question:"Consonance is repetition of…", type:"multiple", options:["Consonant sounds","Only vowels","Only rhyme","Only metaphor"], answer:"Consonant sounds", explanation:"Consonance repeats consonant sounds." },
      { id:"q22", module:3, question:"Irony involves…", type:"multiple", options:["Contrast between expectation and reality","Only rhyme","Only meter","Only setting"], answer:"Contrast between expectation and reality", explanation:"Irony depends on mismatch/contrast." },
      { id:"q23", module:3, question:"A symbol…", type:"multiple", options:["Represents more than itself","Is always literal","Is only sound","Is only plot"], answer:"Represents more than itself", explanation:"Symbols carry layered meaning." },
      { id:"q24", module:3, question:"Allusion is…", type:"multiple", options:["A reference to something known","A stanza break","A conflict type","A rhyme error"], answer:"A reference to something known", explanation:"Allusion adds meaning through reference." },
      { id:"q25", module:3, question:"Hyperbole is…", type:"multiple", options:["Exaggeration for effect","A factual report","A symbol only","A meter"], answer:"Exaggeration for effect", explanation:"Hyperbole exaggerates deliberately." },
      { id:"q26", module:3, question:"Understatement is…", type:"multiple", options:["Downplaying for effect","Overstating","Only imagery","Only rhyme"], answer:"Downplaying for effect", explanation:"Understatement minimizes deliberately." },
      { id:"q27", module:3, question:"Sound devices can shape mood.", type:"truefalse", options:["True","False"], answer:true, explanation:"Sound texture affects tone." },
      { id:"q28", module:3, question:"Name one sound device (short).", type:"short", answer:"alliteration", explanation:"Examples: alliteration, assonance, consonance, rhyme." },

      { id:"q29", module:4, question:"A stanza is…", type:"multiple", options:["A group of lines","A character","A setting","A plot twist"], answer:"A group of lines", explanation:"Stanza = grouped lines." },
      { id:"q30", module:4, question:"The speaker is…", type:"multiple", options:["The voice speaking in the poem","Always the poet","Always the reader","The rhyme scheme"], answer:"The voice speaking in the poem", explanation:"Speaker is a persona/voice." },
      { id:"q31", module:4, question:"Meter refers to…", type:"multiple", options:["Stress pattern","Plot structure","Stage movement","Character traits"], answer:"Stress pattern", explanation:"Meter = stress pattern." },
      { id:"q32", module:4, question:"Diction means…", type:"multiple", options:["Word choice","Line breaks","Stage setting","Rhyme only"], answer:"Word choice", explanation:"Diction is word choice." },
      { id:"q33", module:4, question:"Syntax means…", type:"multiple", options:["Word order","Only vocabulary","Only sound","Only imagery"], answer:"Word order", explanation:"Syntax = arrangement of words." },
      { id:"q34", module:4, question:"Poetry is often…", type:"multiple", options:["Compressed and patterned","Only long prose","Only factual","Only dialogue"], answer:"Compressed and patterned", explanation:"Poetry intensifies meaning through pattern." },
      { id:"q35", module:4, question:"Form can shape meaning.", type:"truefalse", options:["True","False"], answer:true, explanation:"Structure influences emphasis and pacing." },
      { id:"q36", module:4, question:"Define stanza (short).", type:"short", answer:"group", explanation:"A stanza is a group of lines." },

      { id:"q37", module:5, question:"Close reading focuses on…", type:"multiple", options:["How language works","Only summary","Only biography","Only cover design"], answer:"How language works", explanation:"Close reading explains meaning through language patterns." },
      { id:"q38", module:5, question:"Contrast helps by…", type:"multiple", options:["Sharpening meaning through oppositions","Removing imagery","Avoiding sound","Forcing one reading"], answer:"Sharpening meaning through oppositions", explanation:"Contrast highlights tensions and themes." },
      { id:"q39", module:5, question:"Summarizing is the same as analyzing.", type:"truefalse", options:["True","False"], answer:false, explanation:"Analysis explains how meaning is produced." },
      { id:"q40", module:5, question:"Name one focus in close reading (short).", type:"short", answer:"imagery", explanation:"Examples: imagery, diction, sound, structure." },

      { id:"q41", module:6, question:"Drama is primarily meant to be…", type:"multiple", options:["Performed","Memorized as a list","Only read silently","Only drawn"], answer:"Performed", explanation:"Drama is written for performance." },
      { id:"q42", module:6, question:"Stage directions mainly…", type:"multiple", options:["Guide performance","Replace dialogue","Explain metaphors","Count syllables"], answer:"Guide performance", explanation:"They instruct staging and action." },
      { id:"q43", module:6, question:"Conflict is…", type:"multiple", options:["Central struggle driving action","The font","A stanza type","A rhyme scheme"], answer:"Central struggle driving action", explanation:"Conflict drives tension and plot." },
      { id:"q44", module:6, question:"Dialogue is crucial in drama.", type:"truefalse", options:["True","False"], answer:true, explanation:"Dialogue drives action and character." },

      { id:"q45", module:7, question:"In Trifles, meaning often comes from…", type:"multiple", options:["Small details treated as evidence","Only long speeches","Random guessing","Only the title"], answer:"Small details treated as evidence", explanation:"Details produce inference." },
      { id:"q46", module:7, question:"Subtext is…", type:"multiple", options:["Implied meaning beneath words","Only directions","Only rhyme","Only plot"], answer:"Implied meaning beneath words", explanation:"Subtext is what is suggested, not directly stated." },
      { id:"q47", module:7, question:"Inference means…", type:"multiple", options:["Conclusion from evidence","A dictionary meaning","A rhyme scheme","A scene break"], answer:"Conclusion from evidence", explanation:"Inference uses clues to reason." },
      { id:"q48", module:7, question:"Evidence matters more than opinion in analysis.", type:"truefalse", options:["True","False"], answer:true, explanation:"Claims need textual support." },

      { id:"q49", module:8, question:"A novella is usually…", type:"multiple", options:["Between short story and novel","Longer than a novel","Shorter than a paragraph","Not fiction"], answer:"Between short story and novel", explanation:"Novella sits between short story and novel." },
      { id:"q50", module:9, question:"Austen’s opening signals…", type:"multiple", options:["Irony and social critique","A scientific law","A direction","A literal command"], answer:"Irony and social critique", explanation:"The line frames social satire." },
    ];

    /* Data: 25 maps */
    const mindmaps = [
      { id:"mm1", module:1, title:"Major Genres", nodes:[
        {text:"Poetry", children:[{text:"sound"},{text:"imagery"},{text:"form"}], link:"module4"},
        {text:"Drama", children:[{text:"dialogue"},{text:"stage directions"},{text:"conflict"}], link:"module6"},
        {text:"Fiction", children:[{text:"plot"},{text:"character"},{text:"setting"},{text:"point of view"}], link:"module8"},
      ]},
      { id:"mm2", module:2, title:"Core Figures of Speech", nodes:[
        {text:"Simile", children:[{text:"like/as"}]},
        {text:"Metaphor", children:[{text:"direct comparison"}]},
        {text:"Imagery", children:[{text:"five senses"}]},
        {text:"Personification", children:[{text:"human qualities"}]},
        {text:"Onomatopoeia", children:[{text:"sound words"}]},
      ], link:"module2"},
      { id:"mm3", module:3, title:"Sound Devices", nodes:[
        {text:"Alliteration"},{text:"Assonance"},{text:"Consonance"},{text:"Rhyme"},{text:"Rhythm"}
      ], link:"module3"},
      { id:"mm4", module:4, title:"Poetry Elements", nodes:[
        {text:"Speaker"},{text:"Diction"},{text:"Syntax"},{text:"Imagery"},{text:"Sound"},{text:"Form"},{text:"Theme"}
      ], link:"module4"},
      { id:"mm5", module:5, title:"Close Reading", nodes:[
        {text:"Pattern", children:[{text:"sound"},{text:"imagery"},{text:"structure"}]},
        {text:"Effect", children:[{text:"mood"},{text:"emphasis"}]},
        {text:"Meaning", children:[{text:"interpretation"}]},
      ], link:"module5"},
      { id:"mm6", module:6, title:"Drama Toolkit", nodes:[
        {text:"Dialogue"},{text:"Stage Directions"},{text:"Conflict"},{text:"Scene/Act"}
      ], link:"module6"},
      { id:"mm7", module:7, title:"Evidence and Inference", nodes:[
        {text:"Details"},{text:"Inference"},{text:"Subtext"},{text:"Authority"}
      ], link:"module7"},
      { id:"mm8", module:8, title:"Fiction Elements", nodes:[
        {text:"Plot"},{text:"Character"},{text:"Setting"},{text:"Point of View"},{text:"Theme"}
      ], link:"module8"},
      { id:"mm9", module:9, title:"Austen Focus", nodes:[
        {text:"Irony"},{text:"Class"},{text:"Manners"},{text:"Marriage economy"}
      ], link:"module9"},
    ];
    while (mindmaps.length < 25){
      const n = mindmaps.length + 1;
      mindmaps.push({
        id:"mm"+n, module:0, title:"Revision Map " + n,
        nodes:[
          {text:"Claim", children:[{text:"what you argue"}]},
          {text:"Evidence", children:[{text:"quote/detail"}]},
          {text:"Explanation", children:[{text:"how evidence supports claim"}]},
          {text:"Device", children:[{text:"figure/sound/form"}]},
        ],
        link:"review"
      });
    }

    /* Helpers */
    function getPracticeContainer(module){ return document.getElementById(`m${module}Practice`); }
    function clearPractice(module){ const c = getPracticeContainer(module); if (c) c.innerHTML = ""; }
    function escapeHTML(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
    function shuffle(arr){
      const a = arr.slice();
      for (let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    /* Terms */
    function showFlashcards(module){
      clearPractice(module);
      const container = getPracticeContainer(module);
      if (!container) return;

      const deck = shuffle(flashcards.filter(f=>f.module===module));
      container.innerHTML = `<div class="callout">Click a card to reveal the definition. Mark mastery as you revise.</div><div class="flashWrap" id="flashWrap${module}"></div>`;
      const wrap = document.getElementById(`flashWrap${module}`);

      deck.forEach(f=>{
        const status = state.mastered[f.id] || "review";
        const card = document.createElement("div");
        card.className = "flashcard";
        card.innerHTML = `
          <div>
            <div class="flashFront">${escapeHTML(f.term)}</div>
            <div class="flashBack">${escapeHTML(f.definition)}</div>
          </div>
          <div class="statusRow">
            <button class="statusBtn ${status==="review"?"active":""}" data-id="${f.id}" data-st="review">Review</button>
            <button class="statusBtn ${status==="known"?"active":""}" data-id="${f.id}" data-st="known">Known</button>
            <button class="statusBtn ${status==="mastered"?"active":""}" data-id="${f.id}" data-st="mastered">Mastered</button>
          </div>
        `;
        card.addEventListener("click",(e)=>{
          if (e.target.classList.contains("statusBtn")) return;
          card.classList.toggle("flipped");
        });
        card.querySelectorAll(".statusBtn").forEach(btn=>{
          btn.addEventListener("click",(e)=>{
            e.stopPropagation();
            state.mastered[btn.dataset.id] = btn.dataset.st;
            saveState();
            card.querySelectorAll(".statusBtn").forEach(b=>b.classList.toggle("active", b.dataset.st===btn.dataset.st));
          });
        });
        wrap.appendChild(card);
      });

      updateStats();
    }

    function showAllFlashcards(){
      const reviewArea = document.getElementById("reviewArea");
      if (!reviewArea) return;
      reviewArea.innerHTML = `<div class="callout"><b>Key Terms</b> — click to reveal definitions and mark mastery.</div>`;
      const deck = shuffle(flashcards);
      const wrap = document.createElement("div");
      wrap.className = "flashWrap";

      deck.forEach(f=>{
        const status = state.mastered[f.id] || "review";
        const card = document.createElement("div");
        card.className = "flashcard";
        card.innerHTML = `
          <div>
            <div class="flashFront">${escapeHTML(f.term)} <span style="font-size:14px;color:rgba(11,27,19,.55);font-weight:800;">(M${f.module})</span></div>
            <div class="flashBack">${escapeHTML(f.definition)}</div>
          </div>
          <div class="statusRow">
            <button class="statusBtn ${status==="review"?"active":""}" data-id="${f.id}" data-st="review">Review</button>
            <button class="statusBtn ${status==="known"?"active":""}" data-id="${f.id}" data-st="known">Known</button>
            <button class="statusBtn ${status==="mastered"?"active":""}" data-id="${f.id}" data-st="mastered">Mastered</button>
          </div>
        `;
        card.addEventListener("click",(e)=>{
          if (e.target.classList.contains("statusBtn")) return;
          card.classList.toggle("flipped");
        });
        card.querySelectorAll(".statusBtn").forEach(btn=>{
          btn.addEventListener("click",(e)=>{
            e.stopPropagation();
            state.mastered[btn.dataset.id] = btn.dataset.st;
            saveState();
            card.querySelectorAll(".statusBtn").forEach(b=>b.classList.toggle("active", b.dataset.st===btn.dataset.st));
          });
        });
        wrap.appendChild(card);
      });

      reviewArea.appendChild(wrap);
      updateStats();
    }

    /* Questions */
    function renderFeedback(container, ok, explanation){
      const old = container.querySelector(".feedback");
      if (old) old.remove();
      const p = document.createElement("div");
      p.className = "feedback " + (ok ? "good":"bad");
      p.innerHTML = ok ? `✅ <b>Correct.</b> ${escapeHTML(explanation)}` : `❌ <b>Incorrect.</b> ${escapeHTML(explanation)}`;
      container.appendChild(p);
    }

    function showQuiz(module){
      clearPractice(module);
      const container = getPracticeContainer(module);
      if (!container) return;

      const set = shuffle(quizzes.filter(q=>q.module===module)).slice(0,6);
      container.innerHTML = `
        <div class="callout">Answer the questions and submit each item for feedback.</div>
        <div id="quizWrap${module}"></div>
        <div class="toolbar" style="margin-top:12px;">
          <div class="left"><button class="btn" onclick="showQuiz(${module})">New Set</button></div>
        </div>
      `;

      const wrap = document.getElementById(`quizWrap${module}`);
      set.forEach((q, idx)=>{
        const box = document.createElement("div");
        box.className = "quiz-question";
        box.innerHTML = `<p>${idx+1}. ${escapeHTML(q.question)}</p>`;

        if (q.type === "multiple"){
          q.options.forEach(opt=>{
            const lab = document.createElement("label");
            lab.className = "opt";
            lab.innerHTML = `<input type="radio" name="q_${module}_${q.id}" value="${escapeHTML(opt)}"><span>${escapeHTML(opt)}</span>`;
            box.appendChild(lab);
          });
        } else if (q.type === "truefalse"){
          ["true","false"].forEach(v=>{
            const lab = document.createElement("label");
            lab.className = "opt";
            lab.innerHTML = `<input type="radio" name="q_${module}_${q.id}" value="${v}"><span>${v[0].toUpperCase()+v.slice(1)}</span>`;
            box.appendChild(lab);
          });
        } else {
          const input = document.createElement("input");
          input.type = "text";
          input.style.width = "100%";
          input.style.padding = "12px";
          input.style.borderRadius = "14px";
          input.style.border = "1px solid rgba(11,27,19,.16)";
          input.style.fontSize = "18px";
          input.id = `short_${module}_${q.id}`;
          box.appendChild(input);
        }

        const btn = document.createElement("button");
        btn.className = "btn primary";
        btn.textContent = "Submit";
        btn.style.marginTop = "10px";

        btn.onclick = ()=>{
          let ok = false;

          if (q.type === "short"){
            const user = (document.getElementById(`short_${module}_${q.id}`).value || "").trim().toLowerCase();
            ok = user.includes((q.answer||"").toLowerCase());
            if (ok) state.correct[q.id] = true;
            renderFeedback(box, ok, q.explanation);
          } else {
            const checked = document.querySelector(`input[name="q_${module}_${q.id}"]:checked`);
            if (!checked){ renderFeedback(box, false, "Please select an answer."); return; }
            const val = checked.value;
            ok = (q.type==="truefalse") ? (String(q.answer) === (val==="true" ? "true":"false")) : (val === q.answer);
            if (ok) state.correct[q.id] = true;
            renderFeedback(box, ok, q.explanation);
          }

          saveState();
        };

        box.appendChild(btn);
        wrap.appendChild(box);
      });

      updateStats();
    }

    function showAllQuizzes(){
      const reviewArea = document.getElementById("reviewArea");
      if (!reviewArea) return;

      reviewArea.innerHTML = `<div class="callout"><b>Question Bank</b> — review answers and explanations.</div>`;
      const list = document.createElement("div");

      quizzes.forEach((q, i)=>{
        const box = document.createElement("div");
        box.className = "quiz-question";
        const done = state.correct[q.id] ? "✅" : "—";
        box.innerHTML = `<p>${i+1}. ${done} <span style="color:rgba(11,27,19,.55);font-weight:800;">(M${q.module})</span> ${escapeHTML(q.question)}</p>`;
        const explain = document.createElement("div");
        explain.className = "callout";
        explain.style.margin = "10px 0 0";
        explain.innerHTML = `<b>Answer:</b> ${escapeHTML(String(q.answer))}<br><b>Explanation:</b> ${escapeHTML(q.explanation)}`;
        box.appendChild(explain);
        list.appendChild(box);
      });

      reviewArea.appendChild(list);
      updateStats();
    }

    /* Matching */
    function showMatching(module){
      clearPractice(module);
      const container = getPracticeContainer(module);
      if (!container) return;

      const pool = flashcards.filter(f=>f.module===module);
      const set = shuffle(pool).slice(0,6);
      const terms = shuffle(set.map(x=>({id:x.id, text:x.term})));
      const defs  = shuffle(set.map(x=>({id:x.id, text:x.definition})));

      container.innerHTML = `
        <div class="callout">Drag each term onto the correct definition.</div>
        <div class="matchGrid">
          <div class="zone"><b>Terms</b><div id="terms_${module}"></div></div>
          <div class="zone"><b>Definitions</b><div id="defs_${module}"></div></div>
        </div>
        <div class="toolbar" style="margin-top:12px;">
          <div class="left"><button class="btn" onclick="showMatching(${module})">New Set</button></div>
        </div>
      `;

      const termsEl = document.getElementById(`terms_${module}`);
      const defsEl  = document.getElementById(`defs_${module}`);

      let solved = 0;

      terms.forEach(t=>{
        const el = document.createElement("div");
        el.className = "draggable";
        el.draggable = true;
        el.dataset.id = t.id;
        el.textContent = t.text;
        el.addEventListener("dragstart",(e)=>e.dataTransfer.setData("text/plain", t.id));
        termsEl.appendChild(el);
      });

      defs.forEach(d=>{
        const dz = document.createElement("div");
        dz.className = "dropDef";
        dz.dataset.id = d.id;
        dz.innerHTML = `<b style="display:block;margin-bottom:6px;">Definition</b>${escapeHTML(d.text)}`;

        dz.addEventListener("dragover",(e)=>e.preventDefault());
        dz.addEventListener("drop",(e)=>{
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text/plain");
          const termEl = termsEl.querySelector(`.draggable[data-id="${draggedId}"]`);
          if (!termEl) return;

          if (draggedId === d.id){
            dz.style.borderColor = "rgba(22,163,74,.45)";
            dz.style.background = "rgba(22,163,74,.10)";
            dz.innerHTML = `<b style="display:block;margin-bottom:6px;">Matched</b><div style="margin-bottom:8px;"><b>${escapeHTML(termEl.textContent)}</b></div>${escapeHTML(d.text)}`;
            termEl.remove();
            solved++;
            if (solved === defs.length){
              const done = document.createElement("div");
              done.className = "callout";
              done.innerHTML = `<b>Completed.</b> Continue to the questions for this module.`;
              container.appendChild(done);
            }
          } else {
            dz.style.borderColor = "rgba(255,77,77,.40)";
            dz.style.background = "rgba(255,77,77,.10)";
            dz.animate([{transform:"translateX(0)"},{transform:"translateX(-8px)"},{transform:"translateX(8px)"},{transform:"translateX(0)"}], {duration:260});
          }
        });

        defsEl.appendChild(dz);
      });
    }

    /* Maps */
    function showMindMap(module){
      clearPractice(module);
      const container = getPracticeContainer(module);
      if (!container) return;

      const maps = mindmaps.filter(m => (m.module===module || m.module===0)).slice(0,3);
      container.innerHTML = `<div class="callout">Open a map to revise key ideas and connections.</div>`;

      maps.forEach(m=>{
        const mapDiv = document.createElement("div");
        mapDiv.className = "mindmap";
        mapDiv.innerHTML = `<div class="node">${escapeHTML(m.title)} <span style="font-size:14px;font-weight:800;color:rgba(11,27,19,.55);">(${m.id})</span><div class="child"></div></div>`;
        const node = mapDiv.querySelector(".node");
        const child = mapDiv.querySelector(".child");

        child.innerHTML = `<ul style="margin:0;padding-left:18px;">
          ${m.nodes.map(n=>`
            <li style="margin:8px 0;">
              ${n.link ? `<a href="#" onclick="showSection('${n.link}'); return false;" style="color:#0077cc;font-weight:900;text-decoration:none;">${escapeHTML(n.text)}</a>` : `<span>${escapeHTML(n.text)}</span>`}
              ${n.children ? `<ul style="margin:6px 0 0 18px;">${n.children.map(c=>`<li>${escapeHTML(c.text)}</li>`).join("")}</ul>` : ""}
            </li>
          `).join("")}
        </ul>`;

        node.addEventListener("click", ()=>{
          node.classList.toggle("expanded");
          mapDiv.classList.toggle("expanded");
          markMindMapExplored(m.id);
        });

        container.appendChild(mapDiv);
      });

      updateStats();
    }

    function showAllMindMaps(){
      const reviewArea = document.getElementById("reviewArea");
      if (!reviewArea) return;

      reviewArea.innerHTML = `<div class="callout"><b>Revision Maps</b> — open each map to revise key concepts.</div>`;
      mindmaps.forEach(m=>{
        const mapDiv = document.createElement("div");
        mapDiv.className = "mindmap";
        mapDiv.innerHTML = `<div class="node">${escapeHTML(m.title)} <span style="font-size:14px;font-weight:800;color:rgba(11,27,19,.55);">(${m.id})</span><div class="child"></div></div>`;
        const node = mapDiv.querySelector(".node");
        const child = mapDiv.querySelector(".child");

        child.innerHTML = `<ul style="margin:0;padding-left:18px;">
          ${m.nodes.map(n=>`
            <li style="margin:8px 0;">
              ${m.link ? `<a href="#" onclick="showSection('${m.link}'); return false;" style="color:#0077cc;font-weight:900;text-decoration:none;">${escapeHTML(n.text)}</a>` : `<span>${escapeHTML(n.text)}</span>`}
              ${n.children ? `<ul style="margin:6px 0 0 18px;">${n.children.map(c=>`<li>${escapeHTML(c.text)}</li>`).join("")}</ul>` : ""}
            </li>
          `).join("")}
        </ul>`;

        node.addEventListener("click", ()=>{
          node.classList.toggle("expanded");
          mapDiv.classList.toggle("expanded");
          markMindMapExplored(m.id);
        });

        reviewArea.appendChild(mapDiv);
      });

      updateStats();
    }

    /* Audio (offline, generated) */
    let audioCtx = null;
    let musicOn = false;
    let nodes = [];
    let chirpTimer = null;

    async function ensureAudio(){
      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === "suspended") await audioCtx.resume();
    }

    function startAudio(){
      if (musicOn) return;
      musicOn = true;

      const ctx = audioCtx;
      const master = ctx.createGain();
      master.gain.value = 0.06;
      master.connect(ctx.destination);

      // Wind noise
      const bufferSize = 2 * ctx.sampleRate;
      const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const data = noiseBuffer.getChannelData(0);
      for (let i=0;i<bufferSize;i++) data[i]=(Math.random()*2-1)*0.22;
      const noise = ctx.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;

      const windFilter = ctx.createBiquadFilter();
      windFilter.type = "lowpass";
      windFilter.frequency.value = 520;

      const windGain = ctx.createGain();
      windGain.gain.value = 0.75;

      const lfo = ctx.createOscillator();
      lfo.type = "sine";
      lfo.frequency.value = 0.08;
      const lfoGain = ctx.createGain();
      lfoGain.gain.value = 140;
      lfo.connect(lfoGain);
      lfoGain.connect(windFilter.frequency);

      noise.connect(windFilter);
      windFilter.connect(windGain);
      windGain.connect(master);

      // Soft pad
      const padGain = ctx.createGain();
      padGain.gain.value = 0.55;
      padGain.connect(master);

      const freqs = [196, 220, 247, 294];
      const oscs = freqs.map(f=>{
        const o = ctx.createOscillator();
        o.type = "sine";
        o.frequency.value = f;
        const g = ctx.createGain();
        g.gain.value = 0.12;
        o.connect(g); g.connect(padGain);
        return o;
      });

      // Bird chirps
      function chirp(){
        if (!musicOn) return;
        const t = ctx.currentTime;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.setValueAtTime(900+Math.random()*900, t);
        o.frequency.exponentialRampToValueAtTime(1200+Math.random()*1200, t+0.09);
        g.gain.setValueAtTime(0.0001, t);
        g.gain.exponentialRampToValueAtTime(0.20, t+0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t+0.14);
        const hp = ctx.createBiquadFilter();
        hp.type = "highpass";
        hp.frequency.value = 600;
        o.connect(hp); hp.connect(g); g.connect(master);
        o.start(t); o.stop(t+0.16);
        chirpTimer = setTimeout(chirp, 900 + Math.random()*2200);
      }

      noise.start();
      lfo.start();
      oscs.forEach(o=>o.start());
      chirp();

      nodes = [master, noise, windFilter, windGain, lfo, lfoGain, padGain, ...oscs];
      document.getElementById("musicBtn").textContent = "Audio: On";
      state.musicOn = true; saveState();
    }

    function stopAudio(){
      if (!musicOn) return;
      musicOn = false;
      try{
        nodes.forEach(n=>{
          if (n && typeof n.stop === "function"){
            try{ n.stop(0); }catch{}
          }
        });
      }catch{}
      nodes = [];
      if (chirpTimer) clearTimeout(chirpTimer);
      chirpTimer = null;

      document.getElementById("musicBtn").textContent = "Audio";
      state.musicOn = false; saveState();
    }

    async function toggleAudio(){
      await ensureAudio();
      if (!musicOn) startAudio(); else stopAudio();
    }
    document.getElementById("musicBtn").addEventListener("click", toggleAudio);

    /* Background animation */
    const bgCanvas = document.getElementById("bgCanvas");
    const bg = bgCanvas.getContext("2d");
    let W=0,H=0,DPR=1;
    const clouds=[], leaves=[], pollen=[];

    function resizeBG(){
      DPR = devicePixelRatio || 1;
      W = bgCanvas.width = innerWidth * DPR;
      H = bgCanvas.height = innerHeight * DPR;
      bgCanvas.style.width = innerWidth + "px";
      bgCanvas.style.height = innerHeight + "px";
      initBG();
    }
    window.addEventListener("resize", resizeBG);

    function rand(a,b){ return a + Math.random()*(b-a); }

    function initBG(){
      clouds.length=0; leaves.length=0; pollen.length=0;
      const cloudCount = Math.round(Math.min(10, Math.max(5, innerWidth/220)));
      const leafCount  = Math.round(Math.min(48, Math.max(20, innerWidth/26)));
      const pollCount  = Math.round(Math.min(90, Math.max(40, innerWidth/18)));

      for (let i=0;i<cloudCount;i++){
        clouds.push({ x:rand(0,W), y:rand(0,H*0.45), w:rand(170,320)*DPR, h:rand(60,110)*DPR, vx:rand(0.05,0.13)*DPR, a:rand(0.08,0.16) });
      }
      for (let i=0;i<leafCount;i++){
        leaves.push({ x:rand(0,W), y:rand(0,H), r:rand(10,24)*DPR, s:rand(0.35,1.10)*DPR, rot:rand(0,Math.PI*2), drot:rand(-0.012,0.012), sway:rand(0.6,2.2)*DPR });
      }
      for (let i=0;i<pollCount;i++){
        pollen.push({ x:rand(0,W), y:rand(0,H), r:rand(1.2,3.1)*DPR, vx:rand(-0.06,0.06)*DPR, vy:rand(-0.03,0.10)*DPR, a:rand(0.10,0.22) });
      }
    }

    function drawSun(){
      const cx=W*0.78, cy=H*0.14;
      const r1=Math.min(W,H)*0.10;
      const r2=Math.min(W,H)*0.24;
      const g=bg.createRadialGradient(cx,cy,r1,cx,cy,r2);
      g.addColorStop(0,"rgba(255,209,102,0.36)");
      g.addColorStop(1,"rgba(255,209,102,0.00)");
      bg.fillStyle=g;
      bg.beginPath(); bg.arc(cx,cy,r2,0,Math.PI*2); bg.fill();
    }

    function drawCloud(c){
      bg.save();
      bg.translate(c.x,c.y);
      bg.fillStyle=`rgba(255,255,255,${c.a})`;
      bg.beginPath();
      bg.ellipse(0,0,c.w*0.32,c.h*0.35,0,0,Math.PI*2);
      bg.ellipse(c.w*0.18,-c.h*0.10,c.w*0.28,c.h*0.30,0,0,Math.PI*2);
      bg.ellipse(-c.w*0.18,-c.h*0.12,c.w*0.26,c.h*0.28,0,0,Math.PI*2);
      bg.ellipse(0,-c.h*0.20,c.w*0.22,c.h*0.26,0,0,Math.PI*2);
      bg.fill();
      bg.restore();
    }

    function drawLeaf(l){
      bg.save();
      bg.translate(l.x,l.y);
      bg.rotate(l.rot);
      const grad=bg.createRadialGradient(0,0,1,0,0,l.r);
      grad.addColorStop(0,"rgba(34,197,94,0.22)");
      grad.addColorStop(1,"rgba(0,163,255,0.06)");
      bg.fillStyle=grad;
      bg.beginPath();
      bg.ellipse(0,0,l.r*0.55,l.r,0,0,Math.PI*2);
      bg.fill();
      bg.strokeStyle="rgba(11,27,19,0.10)";
      bg.lineWidth=1*DPR;
      bg.beginPath();
      bg.moveTo(0,-l.r*0.85);
      bg.lineTo(0,l.r*0.85);
      bg.stroke();
      bg.restore();
    }

    function bgLoop(){
      bg.clearRect(0,0,W,H);

      const haze=bg.createRadialGradient(W*0.25,H*0.10,0,W*0.25,H*0.10,Math.min(W,H)*0.55);
      haze.addColorStop(0,"rgba(0,163,255,0.08)");
      haze.addColorStop(1,"rgba(0,0,0,0)");
      bg.fillStyle=haze;
      bg.fillRect(0,0,W,H);

      drawSun();

      clouds.forEach(c=>{
        c.x += c.vx;
        if (c.x > W + c.w) c.x = -c.w;
        drawCloud(c);
      });

      pollen.forEach(p=>{
        p.x += p.vx; p.y += p.vy;
        if (p.x < -60) p.x = W+60;
        if (p.x > W+60) p.x = -60;
        if (p.y > H+60) p.y = -60;
        if (p.y < -60) p.y = H+60;
        bg.beginPath();
        bg.fillStyle = `rgba(255,209,102,${p.a})`;
        bg.arc(p.x,p.y,p.r,0,Math.PI*2);
        bg.fill();
      });

      leaves.forEach(l=>{
        l.y += l.s;
        l.x += Math.sin(l.y/(90*DPR)) * l.sway * 0.08;
        l.rot += l.drot;
        if (l.y > H + 60){ l.y = -60; l.x = rand(0,W); }
        drawLeaf(l);
      });

      requestAnimationFrame(bgLoop);
    }

    resizeBG();
    bgLoop();

    updateStats();
    showSection("home");

    // No automatic audio start; button remains ready.
    if (state.musicOn){
      state.musicOn = false;
      saveState();
    }
  </script>
</body>
</html>
